# Web Image

Web Image is an experimental backend for Native Image that produces a
WebAssembly module from Java code.

## Prerequisites

Being part of Native Image, see the [Quick Start Guide](../docs/reference-manual/native-image/contribute/DevelopingNativeImage.md)
for all the prerequisites for building Native Image.

In addition, Web Image also uses `wasm-as` from
[binaryen](https://github.com/WebAssembly/binaryen) as its assembler.
Version 119 of `wasm-as` has to be available on your `PATH`.

<details>
<summary>Installation</summary>

Binaryen provides pre-built releases for all major platforms on
[GitHub](https://github.com/WebAssembly/binaryen/releases).

On MacOS, it is recommended to install through [Homebrew](https://brew.sh/), as
the pre-built binaries are not signed and may be quarantined by MacOS.

```bash
brew install binaryen
```
</details>

## Building

To build Web Image, run the `mx build` command in the `web-image` suite:

```bash
cd /path/to/graal
cd web-image
mx build
```

## Usage

Use this as you would use the regular `native-image` tool, but with an
additional `--tool:svm-wasm` flag to enable the WebAssembly backend:

```bash
mx native-image --tool:svm-wasm -cp ... HelloWorld
```

This produces `helloworld.js` and `helloworld.js.wasm` in your working
directory. The `--tool:svm-wasm` flag should be the first argument if possible.
If any experimental options specific to the Wasm backend are used, they can
only be added after the `--tool:svm-wasm` flag.

The JavaScript file is a wrapper that loads and runs the WebAssembly
code and can be run with [Node.js](https://nodejs.org/en) 22 or later:

```bash
# --experimental-wasm-exnref is only required for Node versions before 25
$ node --experimental-wasm-exnref helloworld.js
Hello World
```

## WebAssembly Features

The WebAssembly code generated by Web Image makes use of various WebAssembly
features from WebAssembly 3.0:

- [Garbage Collection](https://github.com/WebAssembly/gc)
- [Exception Handling](https://github.com/WebAssembly/exception-handling/blob/master/proposals/exception-handling/Exceptions.md)
- [Typed Function References](https://github.com/WebAssembly/function-references/blob/main/proposals/function-references/Overview.md)

Support for [WebAssembly 2.0](https://www.w3.org/TR/wasm-core-2/#release-20) is
generally assumed.

## Contributors

- Aleksandar Prokopec
- Christoph Schobesberger
- David Leopoldseder
- Fengyun Liu
- Patrick Ziegler
