/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * Licensed under The Universal Permissive License (UPL), Version 1.0
 * as shown at https://oss.oracle.com/licenses/upl/
 * @ignore
 */
define(["ojs/ojcore","jquery","ojs/ojcontext","ojs/ojcomponentcore","ojdnd"],function(e,t,i,a){"use strict";function n(){}e.TreeDndContext=function(e){this.Init(e)},e.Object.createSubclass(e.TreeDndContext,e.Object,"oj.TreeDndContext"),e.TreeDndContext.prototype.Init=function(t){e.TreeDndContext.superclass.Init.call(this),this.component=t,this.options=t.options,this._reset()},e.TreeDndContext.prototype.isDragEnabled=function(){var e=this._dnd;return e.reorder||e.dragFromEnabled},e.TreeDndContext.prototype.isDropEnabled=function(){var e=this._dnd;return e.reorder||e.dropToEnabled},e.TreeDndContext.prototype.handleDnDOptionChange=function(t){var i=this._dnd,a=e.TreeDndContext,n=i.reorder,s=i.dragFromEnabled;this._dndCleanAll(),this.initDnDOpts(),n===(i=this._dnd).reorder&&s===i.dragFromEnabled||i.reorder||i.dragFromEnabled||this.component._getContainerList().find("li").removeClass(a._OJ_DRAGGABLE).removeClass(a._OJ_DRAG).removeClass(a._OJ_VALID_DROP).removeAttr("draggable"),this.initDnD()},e.TreeDndContext.prototype.initDnDOpts=function(){var i,a,n,s=this.options.dnd,r=this._dnd,o=e.TreeDndContext,d=!0;r.reorder=!1,"object"===typeof s?("string"==typeof(i=s[o._DND_REORDER])&&("enable"===i?(r.reorder=!0,d=!1):"disable"===i&&(d=!1)),d&&(this.options.dnd.reorder="disable"),"object"===typeof(i=s[o._DND_DRAG])&&"object"==typeof(n=i[o._DND_NODE])&&("function"==typeof(a=n[o._DND_DRAGSTART_CB])&&(r.dragStartCallback=a,r.dragFromEnabled=!0),"function"==typeof(a=n[o._DND_DRAGDRAG_CB])&&(r.dragDragCallback=a,r.dragFromEnabled=!0),"function"==typeof(a=n[o._DND_DRAGEND_CB])&&(r.dragEndCallback=a,r.dragFromEnabled=!0),a=n[o._DND_DATATYPES],t.isArray(a)?(r.dragDataTypes=a.slice(),r.dragFromEnabled=!0):"string"==typeof a&&(r.dragDataTypes=[a],r.dragFromEnabled=!0)),"object"===typeof(i=s[o._DND_DROP])&&"object"==typeof(n=i[o._DND_NODE])&&("function"==typeof(a=n[o._DND_DROPDRAGENTER_CB])&&(r.dropDragEnterCallback=a,r.dropToEnabled=!0),"function"==typeof(a=n[o._DND_DROPDRAGOVER_CB])&&(r.dropDragOverCallback=a,r.dropToEnabled=!0),"function"==typeof(a=n[o._DND_DROPDRAGLEAVE_CB])&&(r.dropDragLeaveCallback=a,r.dropToEnabled=!0),"function"==typeof(a=n[o._DND_DROPDROP_CB])&&(r.dropDropCallback=a,r.dropToEnabled=!0),a=n[o._DND_DATATYPES],t.isArray(a)?(r.dropDataTypes=a.slice(),r.dropToEnabled=!0):"string"==typeof a&&(r.dropDataTypes=[a],r.dropToEnabled=!0)),r.reorder||(r.dragDataTypes||r.dragStartCallback||(r.dragFromEnabled=!1,r.dragStartCallback=null,r.dragDragCallback=null,r.dragEndCallback=null,r.dragDataTypes=null),r.dropDropCallback||(r.dropToEnabled=!1,r.dropDragEnterCallback=null,r.dropDragOverCallback=null,r.dropDragLeaveCallback=null,r.dropDropCallback=null,r.dropDataTypes=null)),r.pureReorder=r.reorder&&!r.dragFromEnabled):this.options.dnd={reorder:"disable"}},e.TreeDndContext.prototype.initDnD=function(){var i=this._dnd,a=i.vars,n=e.TreeDndContext;if(i.dragFromEnabled||i.dropToEnabled||i.reorder){e.TreeDndContext._dragMarker?(a.m=e.TreeDndContext._dragMarker,a.ml=e.TreeDndContext._dragMarkerLine):(a.m=t("<div class='oj-tree-drop-marker'><span class='oj-tree-drop-ptr oj-component-icon'>&#160;</span></div>").css("pointer-events","none").hide().appendTo("body"),a.ml=t("<div></div>").addClass(n._OJT_DROP_MARKER_LINE).css("pointer-events","none").hide().appendTo("body"),e.TreeDndContext._dragMarker=a.m,e.TreeDndContext._dragMarkerLine=a.ml),i.ml_width=a.ml.width();var s=this.component.element[0],r=t(s).children("ul:eq(0)");(i.reorder||i.dragFromEnabled)&&(i.fnDragStart=this._dragStart.bind(this),i.fnDragEnd=this._dragEnd.bind(this),t(s).on("dragstart",i.fnDragStart),t(s).on("dragend",i.fnDragEnd),r.length&&r.find("li").addClass(n._OJ_DRAGGABLE).addClass(n._OJ_DRAG).addClass(n._OJ_VALID_DROP).attr("draggable","true")),(i.reorder||i.dropToEnabled)&&(i.fnDrag=this._drag.bind(this),i.fnDragEnter=this._dragEnter.bind(this),i.fnDragOver=this._dragOver.bind(this),i.fnDragLeave=this._dragLeave.bind(this),i.fnDragDrop=this._dragDrop.bind(this),t(s).on("drag",i.fnDrag),t(s).on("dragenter",i.fnDragEnter),t(s).on("dragover",i.fnDragOver),t(s).on("dragleave",i.fnDragLeave),t(s).on("drop",i.fnDragDrop))}},e.TreeDndContext.prototype._closedown=function(){this._dndCleanAll()},e.TreeDndContext.prototype._dragStart=function(i){var a,s,r=t(i.target).closest("li"),o=i.originalEvent.dataTransfer,d=this._dnd,l=d.vars;if(l.o=null,l.r=null,d.nodeLastEnter=null,d.nodeLastLeft=null,d.nodeDraggedId=null,d.dragStarted=!1,!d.reorder&&!d.dragFromEnabled||r.hasClass(n._OJ_DISABLED)||this.component._isTreeDisabled())i.preventDefault();else{if(!this.component._canTypedNodeMove(r,"move"))return!1;if(a=this.component.isSelected(r)?this.component._getNode(null,!0):a=r,(d.dragFromEnabled||d.pureReorder)&&this._setDataTypes(o,a),this._setDragImage(o,a),d.dragStartCallback){var h=this._getDraggedItemArray(a);if(s=d.dragStartCallback(i,{item:h}),i.isDefaultPrevented()||"boolean"==typeof s&&!s)return s;if(!d.dragDataTypes&&!this._checkAddedDataTypes(o)&&!d.reorder)return i.preventDefault(),!1}"uninitialized"===o.effectAllowed&&(d.pureReorder?o.effectAllowed="move":o.effectAllowed=e.DomUtils.isMetaKeyPressed(i)?"copy":"move"),this._dndStartDrag(a,r,i)}},e.TreeDndContext.prototype._drag=function(e){var t=this._dnd;t.dragDragCallback&&t.dragDragCallback(e)},e.TreeDndContext.prototype._dragEnter=function(i){this.component._$container_ul[0].firstChild||this._addInternalNode();var a,s=t(i.target),r=this.component._getNode(s),o=this._dnd,d=o.vars,l=r&&r.length>0&&r.hasClass("oj-tree-node"),h=i.originalEvent.dataTransfer,c=e.TreeDndContext,_=!1,u=!1;if(l&&r.hasClass(n._OJ_TEMPNODE)&&(o.bInternalNode=!0),!l||"UL"!==i.target.tagName||"group"!==i.target.getAttribute("role"))if(o.foreign=!o.dragStarted,!o.foreign&&!o.reorder||o.foreign&&this._isDtType(h,c._DND_INTERNAL_DT_REORDER))this._dndClean();else if(!o.foreign||(_=this._isDtType(h,c._DND_INTERNAL_DT),o.dropToEnabled)){if(d.r=!1,o.nodeLastEnter&&this._clearDropClasses(o.nodeLastEnter),s.hasClass("oj-tree")&&(r=o.nodeLastEnter),!r||!r.length||r.attr("id")!==o.nodeDraggedId)return _&&l&&(o.nodeLastEnter=null,d.o=2),o.foreign&&!_&&(d.o=1),d.r=r,o.nodeLastEnter=r,this._dndPlacement(i,r),this._dndEnter()?(d.r.removeClass(c._OJ_INVALID_DROP).addClass(c._OJ_VALID_DROP).addClass(c._OJ_ACTIVE_DROP),o.dropDragEnterCallback&&(a=o.dropDragEnterCallback(i,{item:o.bInternalNode?null:r,position:o.bInternalNode?"first":o.place,reference:o.bInternalNode?null:d.r})),void 0===a?this._isDtAcceptDataTypes(h)?(i.preventDefault(),i.stopPropagation()):u=o.foreign||!o.reorder:!1===a||i.isDefaultPrevented()?(i.preventDefault(),i.stopPropagation()):!o.foreign&&o.reorder||(u=o.foreign||!o.reorder),u&&this._dndClean(),a):(this._clearDropClasses(d.r),d.r=null,void this._dndHideMarker());this._dndHideMarker()}else this._dndClean()},e.TreeDndContext.prototype._dragOver=function(e){var t,i=this._dnd,a=i.vars,n=e.originalEvent.dataTransfer,s=!1;if(a.r&&a.r.length){var r=a.r;if(r.hasClass("oj-tree-node"))if(r.attr("id")!==i.nodeDraggedId){if(this._dndPlacement(e,r),this._dndPrepare())return i.dropDragOverCallback&&(t=i.dropDragOverCallback(e,{item:i.bInternalNode?null:r,reference:i.bInternalNode?null:a.r,position:i.bInternalNode?"first":a.last_pos})),void 0===t?this._isDtAcceptDataTypes(n)?(e.preventDefault(),e.stopPropagation()):s=i.foreign||!i.reorder:!1===t||e.isDefaultPrevented()?(e.preventDefault(),e.stopPropagation()):!i.foreign&&i.reorder||(s=i.foreign||!i.reorder),s&&this._dndClean(),t;this._dndHideMarker()}else this._dndHideMarker();else this._dndHideMarker()}else this._dndHideMarker()},e.TreeDndContext.prototype._dragDrop=function(e){var t,i=this._dnd,a=i.vars,n=!1;return a.r&&(i.dropDropCallback?t=i.dropDropCallback(e,{reference:i.bInternalNode?null:a.r,position:i.bInternalNode?"first":a.last_pos,reorder:!i.foreign&&i.reorder}):!i.foreign&&i.reorder||(n=!0),n||t&&!e.isDefaultPrevented()||this._dndFinishReorder(e)),i.foreign&&this._dndClean(),n||(e.preventDefault(),e.stopPropagation()),i.nodeLastLeft=null,t},e.TreeDndContext.prototype._dragEnd=function(e){var t=this._dnd,i=t.vars;t.dragEndCallback&&t.dragEndCallback(e,{reorder:t.reorder&&!1===i.o}),this._dndStopDrag(),this._dndClean()},e.TreeDndContext.prototype._addInternalNode=function(){this._internalNode||(this._internalNode=t("<li class='"+n._OJ_TEMPNODE+" oj-tree-node oj-tree-leaf oj-valid-drop' id='"+n._OJ_TEMPNODE+"'><ins class='oj-tree-icon'></ins><a href='#'><ins class='oj-tree-icon'></ins><span class='oj-tree-title'></span></a></li>")),this.component._$container_ul.append(this._internalNode)},e.TreeDndContext.prototype._dragLeave=function(e){var i=this._dnd,a=i.vars,n=t(e.target),s=n.closest("li"),r=s&&s.length>0&&s.hasClass("oj-tree-node"),o=e.originalEvent.dataTransfer;i.dropDragLeaveCallback&&i.dropDragLeaveCallback(e,{item:i.bInternalNode?null:s}),n.hasClass("oj-tree")||!r||"none"===o.dropEffect?this._dndLeave(e):i.nodeLastLeft=s,a.r&&this._clearDropClasses(a.r)},e.TreeDndContext.prototype._dndEnter=function(){var e=this._dnd,t=e.vars;e.prepared=!1;var i=this._dndPrepare(),a=e.openTimeoutMs;a&&(e.openTimer_Id&&clearTimeout(e.openTimerId),t.r&&t.r.length&&t.r.hasClass(n._OJ_COLLAPSED)&&(e.openTimerId=setTimeout(this._dndOpen.bind(this),a)));var s=typeof i;return i="boolean"===s&&i||"string"===s},e.TreeDndContext.prototype._dndOpen=function(){var e=this._dnd,t=e.vars;e.openTimerId=!1,this.component._expand(t.r,this._dndPrepare.bind(this),!0)},e.TreeDndContext.prototype._dndFinishReorder=function(t){var i=this._dnd,a=i.vars;i.dragStarted&&i.reorder&&"object"==typeof a.o&&a.o.length>0&&(this.component._moveNode(a.o,a.r,a.last_pos,e.DomUtils.isMetaKeyPressed(t)),a.o=!1)},e.TreeDndContext.prototype._dndFinishSelection=function(e){e.hasClass(n._OJ_SELECTED)&&(e.removeClass(n._OJ_SELECTED),this.component._select(e,!0));for(var i=this.component.getChildren(e),a=i&&i.length?i.length:0,s=0;s<a;s++)this._dndFinishSelection(t(i[s]))},e.TreeDndContext.prototype._dndPlacement=function(e,t){var i=this._dnd;if(t)if(t.hasClass(n._OJ_TEMPNODE))i.place="after";else{e=e.originalEvent,i.off=t.offset();var a=e.pageY-(i.off.top||0);a>=this.component._getNodeHeight()?i.place="after":i.place=a<0?"before":"inside","after"===i.place&&t.hasClass(n._OJ_EXPANDED)&&(i.place="first")}},e.TreeDndContext.prototype._dndLeave=function(e){var t=this._dnd,i=t.vars;t.after=!1,t.before=!1,t.inside=!1,t.lastNodeEnter=null,this._dndHideMarker(),i.r&&i.r[0]===e.target.parentNode&&t.openTimerId&&(clearTimeout(t.openTimerId),t.openTimerId=!1)},e.TreeDndContext.prototype._dndClean=function(){this._dndHideMarker();var e=this._dnd,t=e.vars;t.o=!1,t.r=!1,e.openTimerId&&clearTimeout(e.openTimerId),e.nodeDraggedId=null,e.foreign=!1,e.nodeLastEnter=null,e.nodeLastLeft=null,e.after=!1,e.before=!1,e.inside=!1,e.off=!1,e.prepared=!1,e.openTimerId=!1,e.foreign=!1,e.bInternalNode=!1},e.TreeDndContext.prototype._dndCleanAll=function(){var e,i=this._dnd;(e=t(this.component._getContainer()[0])).off("dragstart",i.fnDragStart),e.off("dragend",i.fnDragEnd),e.off("drag",i.fnDrag),e.off("dragenter",i.fnDragEnter),e.off("dragover",i.fnDragOver),e.off("dragleave",i.fnDragLeave),e.off("drop",i.fnDragDrop),this._dndClean(),this._reset()},e.TreeDndContext.prototype._dndPrepare=function(){var e=this._dnd,t=e.vars,i=this.component,a=!1;if(!t.r||!t.r.length)return!1;if("number"!=typeof t.o||1!==t.o&&2!==t.o){if(!t.o)return!1}else a=!0;return e.off=t.r.offset(),this.component._isRtl&&(e.off.right=e.off.left+t.r.width()-t.r.find(">a").width()-30),e.targ_ml_width=t.r.find("a").width(),a?(e.before="before"===e.place,e.after="after"===e.place,e.inside="inside"===e.place):(i._prepare_move(t.o,t.r,"before"),e.before=i._checkMove(),i._prepare_move(t.o,t.r,"after"),e.after=i._checkMove(),this.component._isLoaded(t.r)?(i._prepare_move(t.o,t.r,"inside"),e.inside=i._checkMove()):e.inside=!1),e.prepared=!0,this._dndShowMarker()},e.TreeDndContext.prototype._dndShowMarker=function(){var t,i,a,n,s=this._dnd,r=e.TreeDndContext,o=s.vars,d=this.component._isRtl,l=this.component._getNodeHeight(),h=!1;if(!s.prepared)return this._dndHideMarker(),h;if(("after"===s.place&&s.after||"inside"===s.place&&s.inside||"before"===s.place&&s.before||"first"===s.place)&&(h=s.place),"first"===h){var c=o.r.find("li:eq(0)");s.off=c.offset()}var _=d?s.off.right-18:s.off.left+5;switch(t=!this.component.isLeaf(o.r),i=d?_+s.targ_ml_width+18:_,a=d?i-s.ml_width:_+8,n=s.off.top-3,h){case"before":case"first":this._moveMarkerUI(o.m,{left:i,top:n-7}),o.ml&&this._moveMarkerUI(o.ml,{left:a,top:n});break;case"after":n+=l,this._moveMarkerUI(o.m,{left:i,top:n-2}),o.ml&&this._moveMarkerUI(o.ml,{left:a,top:n+6});break;case"inside":var u;u=d?t?-4:0:4,this._moveMarkerUI(o.m,{left:i+u,top:s.off.top+l/2-8}),o.ml&&o.ml.hide();break;default:this._dndHideMarker()}return h?o.r.removeClass(r._OJ_INVALID_DROP).addClass(r._OJ_VALID_DROP):o.r.removeClass(r._OJ_VALID_DROP).removeClass(r._OJ_VALID_DROP),o.last_pos=h,h},e.TreeDndContext.prototype._dndHideMarker=function(){var e=this._dnd.vars;e&&(e.m&&e.m.hide(),e.ml&&e.ml.hide(),e.r&&this._clearDropClasses(e.r))},e.TreeDndContext.prototype._moveMarkerUI=function(e,t){t.left+="px",t.top+="px",e.css(t).show()},e.TreeDndContext.prototype._dndStartDrag=function(t,i,a){var n,s=this._dnd,r=s.vars,o=e.TreeDndContext;r.o=t,r.o.addClass(o._OJ_DRAG),s.nodeDraggedId=i.attr("id");try{a.currentTarget.unselectable="on",a.currentTarget.onselectstart=function(){return!1},a.currentTarget.style&&(a.currentTarget.style.MozUserSelect="none")}catch(e){}this.component._isTheme()&&r.m&&r.m.addClass("oj-tree-"+this.component._getTheme()),n=this.component._getContainer(),s.cof=n.offset(),s.cw=parseInt(n.width(),10),s.ch=parseInt(n.height(),10),s.dragStarted=!0},e.TreeDndContext.prototype._dndStopDrag=function(){var t=this._dnd,i=t.vars,a=e.TreeDndContext;i.r&&this._clearDropClasses(i.r),"number"!=typeof i.o&&i.o&&i.o.removeClass(a._OJ_DRAG),this._dragImg&&(document.body.removeChild(this._dragImg),this._dragImg=null),t.dragStarted=!1},e.TreeDndContext.prototype._setDataTypes=function(t,i){var a,n,s,r=this._dnd,o=e.TreeDndContext;if((a=this.component.__getJson(i))&&(n=JSON.stringify(a)),r.dragDataTypes)for(s=0;s<r.dragDataTypes.length;s++)t.setData(r.dragDataTypes[s],n);t.setData(o._DND_INTERNAL_DT,"0"),r.pureReorder&&t.setData(o._DND_INTERNAL_DT_REORDER,"0")},e.TreeDndContext.prototype._setDragImage=function(e,i){var a=i.length;if(1!==a){var n=t("<div></div>"),s=t("<ul style='padding:0px;margin:0;'></ul>");n.append(s);for(var r=0;r<a;r++){var o=i[r].cloneNode(!0);o.style.marginLeft=0,o.style.paddingLeft=0,s.append(o)}var d=n[0];document.body.appendChild(d),d.style.position="absolute",d.style.top="-"+2*n.height()+"px",d.style.right="0",this._dragImg=d,e.setDragImage(d,0,0)}else this._dragImg=null},e.TreeDndContext.prototype._isDtType=function(e,t){var i,a=e.types,n=a.length;for(i=0;i<n;i++)if(t===a[i])return!0;return!1},e.TreeDndContext.prototype._isDtAcceptDataTypes=function(e){var t,i=this._dnd.dropDataTypes,a=!1;if(i){for(a=!(i.length>0),t=0;t<i.length;t++)if(this._isDtType(e,i[t])){a=!0;break}}else a=!0;return a},e.TreeDndContext.prototype._checkAddedDataTypes=function(t){var i,a,n=t.types,s=n&&n.length?n.length:0,r=e.TreeDndContext,o=!1;for(a=0;a<s;a++)if((i=n[a])!==r._DND_INTERNAL_DT&&i!==r._DND_INTERNAL_DT_REORDER){o=!0;break}return o},e.TreeDndContext.prototype._clearDropClasses=function(t){var i=e.TreeDndContext;t&&t.removeClass(i._OJ_VALID_DROP).removeClass(i._OJ_INVALID_DROP).removeClass(i._OJ_ACTIVE_DROP)},e.TreeDndContext.prototype._getDraggedItemArray=function(e){var t=[];return e&&e.each(function(){t.push(this)}),t},e.TreeDndContext.prototype._reset=function(){var e={};this._dnd=e,e.reorder=!1,e.pureReorder=!1,e.foreign=!1,e.dragStarted=!1,e.nodeDraggedId=null,e.nodeLastEnter=null,e.fnDragStart=null,e.fnDragEnd=null,e.fnDrag=null,e.fnDragEnter=null,e.fnDragOver=null,e.fnDragLeave=null,e.fnDragDrop=null,e.dragFromEnabled=!1,e.dropToEnabled=!1,e.dragStartCallback=null,e.dragDragCallback=null,e.dragDragEndCallback=null,e.dropDragEnterCallback=null,e.dropDragOverCallback=null,e.dropDragLeaveCallback=null,e.dragDropCallback=null,e.dropDataTypes=null,e.after=!1,e.inside=!1,e.before=!1,e.off=!1,e.prepared=!1,e.openTimerId=!1,e.cof=!1,e.cw=!1,e.ch=!1,e.ml_width=100,e.targ_ml_width=100,e.openTimeoutMs=500,e.vars={},e.vars.o=!1,e.vars.r=!1,e.vars.m=!1,e.vars.ml=!1},e.TreeDndContext.prototype._trace=function(e){this.component._trace(e)},e.TreeDndContext._OJ_DRAGGABLE="oj-draggable",e.TreeDndContext._OJ_DRAG="oj-drag",e.TreeDndContext._OJ_ACTIVE_DROP="oj-active-drop",e.TreeDndContext._OJ_VALID_DROP="oj-valid-drop",e.TreeDndContext._OJ_INVALID_DROP="oj-invalid-drop",e.TreeDndContext._OJ_DROP="oj-drop",e.TreeDndContext._OJT_DROP_MARKER="oj-tree-drop-marker",e.TreeDndContext._OJT_DROP_MARKER_LINE="oj-tree-drop-marker-line",e.TreeDndContext._DND_REORDER="reorder",e.TreeDndContext._DND_DRAG="drag",e.TreeDndContext._DND_DROP="drop",e.TreeDndContext._DND_NODE="node",e.TreeDndContext._DND_DATATYPES="dataTypes",e.TreeDndContext._DND_DRAGSTART_CB="dragStart",e.TreeDndContext._DND_DRAGDRAG_CB="drag",e.TreeDndContext._DND_DRAGEND_CB="dragEnd",e.TreeDndContext._DND_DROPDRAGENTER_CB="dragEnter",e.TreeDndContext._DND_DROPDRAGOVER_CB="dragOver",e.TreeDndContext._DND_DROPDRAGLEAVE_CB="dragLeave",e.TreeDndContext._DND_DROPDROP_CB="drop",e.TreeDndContext._DND_INTERNAL_DT="_ojtree",e.TreeDndContext._DND_INTERNAL_DT_REORDER="_ojtreereorder",n._OJ_EXPANDED="oj-expanded",n._OJ_COLLAPSED="oj-collapsed",n._OJ_HOVER="oj-hover",n._OJ_SELECTED="oj-selected",n._OJ_DISABLED="oj-disabled",n._OJ_DEFAULT="oj-default",n._OJ_TEMPNODE="oj-treenode-temp",
/**
 * @license
 * This component is based on original code from:
 * jsTree 1.0-rc3   http://jstree.com/
 * "Copyright (c) 2010 Ivan Bozhanov (vakata.com)
 * Licensed same as jquery - under the terms of either the MIT License or
 * the GPL Version 2 License
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html"
 * @ignore
 */
function(){var s,r="oj-tree-leaf",o="oj-tree-icon",d="oj-tree-node-icon",l="oj-tree-loading",h="oj-tree-icon oj-tree-disclosure-icon oj-component-icon oj-clickable-icon-nocontext oj-default",c="oj-tree-children",_={cut:"ojtreecut",copy:"ojtreecopy",paste:"ojtreepaste","paste-after":"ojtreepasteafter","paste-before":"ojtreepastebefore",remove:"ojtreeremove",rename:"ojtreerename"},u={cut:"labelCut",copy:"labelCopy",paste:"labelPaste","paste-after":"labelPasteAfter","paste-before":"labelPasteBefore",remove:"labelRemove",rename:"labelRename"},p=["id","title","class","role","draggable","style"];t(function(){var e,i;/msie/.test(navigator.userAgent.toLowerCase())?(e=t('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),i=t('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:0}).appendTo("body"),s=e.width()-i.width(),e.add(i).remove()):(e=t("<div></div>").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:0}).prependTo("body").append("<div></div>").find("div").css({width:"100%",height:200}),s=100-e.width(),e.parent().remove())});var f=[];function g(i){var a="";e.DomUtils.isMetaKeyPressed(i)?a+="ctrl+":i.shiftKey&&(a+="shift+");var n=i.which;switch(n){case 32:a+="space";break;case 37:a+="left";break;case 38:a+="up";break;case 39:a+="right";break;case 40:a+="down";break;case 46:a+="del";break;case 33:a+="pgup";break;case 34:a+="pgdn";break;case 35:a+="end";break;case 36:a+="home";break;case 56:a="*";break;case 113:case 121:a+="f"+("1"-(112-n))}if(0===a.length||"shift+"===a||"ctrl+"===a)return!0;var s=null;return t.each(f,function(e,t){if(t._this._data.ui.focused)return t._this._data.ui.touchEvent=!1,"shift+f10"===a?(t._this._data.menu.activeNode=t._this._data.ui.hovered,t._this._data.menu.activeNode||(t._this._data.menu.activeNode=t._this._data.ui.lastSelected)):t._handler[a]&&(i.preventDefault(),s=t._handler[a].call(t._this,i)),!1}),null!=s?s:void 0}function v(e,i){var a=!1,n=!0;if(e.str)return e.title&&(a=t("style[id='"+e.title+"-stylesheet']")[0]),a?n=!1:((a=document.createElement("style")).setAttribute("type","text/css"),e.title&&a.setAttribute("id",e.title+"-stylesheet")),a.styleSheet?n?(document.getElementsByTagName("head")[0].appendChild(a),a.styleSheet.cssText=e.str):a.styleSheet.cssText=a.styleSheet.cssText+" "+e.str:(a.appendChild(document.createTextNode(e.str)),document.getElementsByTagName("head")[0].appendChild(a)),a.sheet||a.styleSheet}var m=-1;e.__registerWidget("oj.ojTree",t.oj.baseComponent,{widgetEventPrefix:"oj",defaultElement:"<div>",options:{dnd:{reorder:"disable"},expandParents:!1,initExpanded:null,initLoaded:[],selection:[],selectionMode:"single",selectedParentCollapse:!1,selectedParentExpand:!0,selectPrevOnDelete:!1,data:null,emptyText:null,icons:!0,types:null,before:null,collapse:null,create:null,collapseAll:null,cut:null,dehover:null,remove:null,destroy:null,expand:null,expandAll:null,hover:null,loaded:null,move:null,paste:null,refresh:null,rename:null},collapse:function(e,i){var a=(i=i||!1)?0:this._animDuration;if(!(e=this._getNode(e)).length||-1===e||!e.hasClass(n._OJ_EXPANDED)||this._data.core.locked||e.hasClass(n._OJ_DISABLED))return!1;var s=this._emitEvent({obj:e,func:"collapse"},"before");("boolean"!=typeof s||s)&&(e.removeClass(n._OJ_EXPANDED).addClass(n._OJ_COLLAPSED).attr("aria-expanded","false"),t(e.children()[0]).removeClass(n._OJ_SELECTED).addClass("oj-default"),this._busyStack.push({op:"c",id:e.attr("id")}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+e.attr("id")+"' is animating."),!i&&a?this._slide(e,!0):this._transitionEnd(t(e.children("UL")[0]),e))},_slide:function(e,i){var a,n,s;a=t(e.children("ul")),this._isSafari?a[0].addEventListener("webkitTransitionEnd",this._proxyTransitionEndHandler):a[0].addEventListener("transitionend",this._proxyTransitionEndHandler),i?(n=a[0].offsetHeight,s=0):(n=0,s=this._getElemHeight(a[0])),a.css("max-height",n+"px"),this._overflow=a.css("overflow"),a.css("overflow","hidden"),i||(a[0].style.display="block"),setTimeout(function(){a.addClass("oj-tree-transition"),a.css("max-height",s+"px")},20)},_getElemHeight:function(e){var i=t("<div style='position: absolute'>"),a=e.parentNode,n=e.nextSibling;a.removeChild(e);var s=e.style.display;e.style.display="block",i.append(e),this._$container[0].appendChild(i[0]);var r=e.offsetHeight||e.scrollHeight;return e.style.display=s,this._$container[0].removeChild(i[0]),i[0].removeChild(e),n?a.insertBefore(e,n):a.appendChild(e),r+10},_transitionEndHandler:function(e){var i=t(e.target),a=i.closest("li");this._isSafari?i[0].removeEventListener("webkitTransitionEnd",this._proxyTransitionEndHandler):i[0].removeEventListener("transitionend",this._proxyTransitionEndHandler),i.removeClass("oj-tree-transition"),this._transitionEnd(i,a)},_transitionEnd:function(e,t){var i;t.hasClass(n._OJ_COLLAPSED)?(i="c",e[0].style.display="none",e.css("max-height",""),this._emitEvent({obj:t},"collapse"),this.after_close(t)):(i="e",e[0].style.display="block",e.css("max-height",""),this._emitEvent({obj:t},"expand")),this._overflow&&(e.css("overflow",this._overflow),this._overflow=null),this._removeFromBusyStack(i,t.attr("id")),this._resolveIfBusyStackEmpty()},collapseAll:function(e,t){var i=e||-1,a=this;if(!this._data.core.locked&&((e=e?this._getNode(e):this._$container)&&-1!==i&&(i=e),e&&-1!==i||(e=this._$container_ul),!e.hasClass(n._OJ_DISABLED))){var s;-1!==i&&this.isExpanded(e)&&(s=e[0]);var r=e.find("li.oj-expanded");r.length&&r.each(function(){a.collapse(this,!t)}),s&&(this.collapse(s,!t),r.splice(0,0,s)),r.length&&this._emitEvent({obj:r,targ:i},"collapseAll")}},expand:function(e,t){this._expand(e,!1,t)},expanded:function(e,i){var a=this;if(e&&"array"===t.type(e))return this._data.core.locked?null:(t.each(e,function(e,t){a._expand(t,!1,i)}),null);for(var n=(e=this._$container_ul.find("li.oj-expanded")).length,s=[],r=0;r<n;r++)s.push(e[r]);return t(s)},expandAll:function(e,t){this._expandAll(e,t)},toggleExpand:function(e,t){if((e=this._getNode(e))&&e.length&&-1!==e&&!e.hasClass(n._OJ_DISABLED)&&!this._data.core.locked)return e.hasClass(n._OJ_COLLAPSED)?this.expand(e,t):e.hasClass(n._OJ_EXPANDED)?this.collapse(e,t):void 0},deselect:function(e){var t=this.options.selection.slice(0);this._deselect(e),this._fireOptionChangeEvent("selection",t,null,null)},deselectAll:function(e){if(!this._data.core.locked){var t=this.options.selection.slice(0);this._deselectAll(e),this._fireOptionChangeEvent("selection",t,null,null)}},select:function(e){this._select(e,!0)},toggleSelect:function(e){return!!(e=this._getNode(e)).length&&(!e.hasClass(n._OJ_DISABLED)&&!this._data.core.locked&&(this._isSelected(e)?this.deselect(e):this._select(e,!0),!0))},isCollapsed:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(n._OJ_COLLAPSED)},isExpanded:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(n._OJ_EXPANDED)},isLeaf:function(e){return this._isLeaf(e)},isSelected:function(e){return this._isSelected(e)},create:function(e,i,a){var n,s,r=t.isArray(a);if(!r||1===a.length)return n=this._createNode(e,i,r?a[0]:a),this._getDndContext()._dndFinishSelection(n),n;if(r=[],"before"!==i)for(s=a.length-1;s>=0;s--)n=this._createNode(e,i,a[s]),r.unshift(n[0]),this._getDndContext()._dndFinishSelection(n);else for(s=0;s<a.length;s++)n=this._createNode(e,i,a[s]),r.push(n[0]),this._getDndContext()._dndFinishSelection(n);return t(r)},remove:function(e){if(!(e=this._getNode(e)).length||e.hasClass(n._OJ_DISABLED)||this._data.core.locked)return!1;var i=this._emitEvent({obj:e,func:"remove"},"before");if("boolean"==typeof i&&!i)return!1;this.__rollback();var a=this._getParent(e),s=t([]),o=this,d=this._getPrev(e);return e.each(function(){s=s.add(o._getPrev(this))}),e=e.detach(),-1!==a&&0===a.find("> ul > li").length&&a.removeClass("oj-expanded oj-collapsed").addClass(r).removeAttr("aria-expanded"),this._cleanNode(a),this._emitEvent({obj:e,prev:d,parent:a},"remove"),e},getText:function(e){return!!(e=this._getNode(e)).length&&(e=(e=e.children("a:eq(0)")).find("span:eq(0)"))[0].textContent},rename:function(e,t){t=this._escapeHtml(t),this._renameNode(e,t)},hover:function(e){this._hover(e)},dehover:function(){this._dehover()},getPath:function(e,t){var i=[],a=this;return!(-1===(e=this._getNode(e))||!e||!e.length)&&(e.parentsUntil(".oj-tree","li").each(function(){i.push(t?this.id:a.getText(this))}),i.reverse(),i.push(t?e.attr("id"):this.getText(e)),i)},getRoot:function(){return this._$container.children("ul:eq(0)")},refresh:function(e){this._super(),this._data.core.locked||this._refresh(e||-1)},move:function(e,t,i,a){this._moveNode(e,t,i,a)},getType:function(e){return this._getType(e)},setType:function(e,t){return this._setType(e,t)},getNodeBySubId:function(e){return e?this._processSubId(e):this.element?this.element[0]:null},getSubIdByNode:function(e){return this._getSubIdFromNodeElem(e)},getContextByNode:function(e){e=null==e?0:e;var t=-1!==(e=this._getNode(e))&&e.length>0;return t||-1===e?{subId:t?"oj-tree-node":"oj-tree",item:t?e[0]:null,node:!!t&&e,leaf:!!t&&this._isLeaf(e)}:null},getParent:function(e){var t=this._getParent(e);return t&&t.length>0?t:null},getPrevSibling:function(e){var t=this._getPrev(e,!0);return t&&t.length>0?t:null},getNextSibling:function(e){var t=this._getNext(e,!0);return t&&t.length>0?t:null},getChildren:function(e){e=e||-1;var t=this._getChildren(e);return(t=t&&t.length?t.not("."+n._OJ_TEMPNODE):t)&&t.length>0?t:null},scrollIntoView:function(e,t,i){var a;if(e?(a=e.node,a=this._getNode(a)):a=-1,-1===a&&(a=this._$container.find("> ul > li:first-child")),a&&a.length){var n="top"===t;return(i=!!i)&&(this._$container_ul.focus(),this.hover(a)),a[0].scrollIntoView(n),this}},_ComponentCreate:function(){if(this._super(),this._index=this._newIndex(),this._elemId=this.element.attr("id"),void 0===this._elemId&&(this._elemId="oj-tree-"+this._getIndex(),this.element.attr("id",this._elemId)),this._$container=this.element,this._$container_ul=null,this._data={},this._tds=null,this._isRtl="rtl"===this._GetReadingDirection(),this._isTouch=e.DomUtils.isTouchSupported(),this._initTree(),this._animDuration=this._getAnimDuration(),this._animDuration){var t=e.AgentUtils.getAgentInfo();this._isSafari=t.browser===e.AgentUtils.BROWSER.SAFARI,this._proxyTransitionEndHandler=this._transitionEndHandler.bind(this)}this._busyStack=[],this._start()},_destroy:function(){this._resolveBusyContext(),this._clearTree(),this._data.html.markup_ul&&(this._unTransformElemIds(this._data.html.markup_ul),this._$container.append(this._data.html.markup_ul),this._data.html.markup_div.remove(),this._data.html.markup_div=!1,this._data.html.useExistingMarkup=!1),this._data.ds.type=0,this._super()},_setOption:function(e,i,a){var n;if("selection"===e)i="string"==typeof i?[i]:i&&i.length?i:[],this._data.core.suppressSelectEvent=!0,this._handleSelectionOptionChange(i),this._data.core.suppressSelectEvent=!1,i=this._getSelected();else if("selectionMode"===e)"none"===i?n=0:"single"===i?n=1:"multiple"===i?n=-1:(n=0,i="none"),n!==this._data.core.selectMode&&(this._data.core.selectMode=n);else if("icons"===e)"boolean"===t.type(i)&&i!==this._data.themes.icons&&(this._data.themes.icons=i,i?this._showIcons():this._hideIcons());else if("contextMenu"===e)this._clearMenu(),i&&(this._initMenuOpts(),this._initMenu(i));else if("disabled"===e)this._handleDisabledChanged(i);else{if("data"===e)return this._super(e,i,a),this._initDSOpts(),this._initDataSource(),this._initExpandedOpts(),void this._loadNodes();if("dnd"===e)return this._super(e,i,a),void this._getDndContext().handleDnDOptionChange(i);"emptyText"===e&&(i=this._escapeHtml(i))}this._super(e,i,a)},_CompareOptionValues:function(e,t,i){return"selection"===e?this._compareSelectionValues(t,i):this._superApply(arguments)},_compareSelectionValues:function(e,i){var a=!1,n=!1,s=e&&e.length?e.length:0,r=i&&i.length?i.length:0;if(s!==r)a=!0;else if(0===s&&0===r)a=!1;else for(var o=0;o<s;o++){var d=t(e[o]).attr("id");n=!1;for(var l=0;l<r;l++)if(d===t(i[l]).attr("id")){n=!0;break}if(!n){a=!0;break}}return!a},_addBusyState:function(e){if(!this._animationResolve){var t=i.getContext(this.element[0]).getBusyContext();this._animationResolve=t.addBusyState({description:e})}},_resolveBusyContext:function(){this._animationResolve&&(this._animationResolve(),this._animationResolve=null)},_isOnBusyStack:function(e,t){for(var i=this._busyStack,a=i.length,n=-1,s=0;s<a;s++)if(i[s].id===t&&i[s].op===e){n=s;break}return n},_removeFromBusyStack:function(e,t){var i=this._isOnBusyStack(e,t);return i>=0&&this._busyStack.splice(i,1),i},_resolveIfBusyStackEmpty:function(){0===this._busyStack.length&&this._resolveBusyContext()},_clearTree:function(){this._TreeDndContext&&(this._TreeDndContext._closedown(),this._TreeDndContext=null);var e=this._getIndex();this._$container.unbind(".oj-tree").undelegate(".oj-tree").removeData("oj-tree-instance-id").find("[class^='oj-tree']").addBack().attr("class",function(){return this.className.replace(/oj-tree[^ ]*|$/gi,"")});var i,a=this._$container.attr("class");0===(a=a.trim()).length&&this._$container.removeAttr("class"),i=this._$container_ul,t.each(f,function(e){if(f[e]._selector===i)return t(i).off("keydown"),f[e]=null,f.splice(e,1),!1}),t(document).unbind(".oj-tree-"+e).undelegate(".oj-tree-"+e),this._$container_ul.remove(),this._$container_ul=null},_getNode:function(e,i){if(null==e)return i?this._data.ui.selected:this._data.ui.lastSelected;var a=t(e,this._getContainer());return a.is(".oj-tree")||-1===e?-1:!!(a=a.closest("li",this._getContainer())).length&&a},_getPrev:function(e,t){if(-1===(e=this._getNode(e)))return this._$container.find("> ul > li:last-child");if(!e.length)return!1;if(t)return e.prevAll("li").length>0&&e.prevAll("li:eq(0)");if(e.prev("li").length){for(e=e.prev("li").eq(0);e.hasClass(n._OJ_EXPANDED);)e=e.children("ul:eq(0)").children("li:last");return e}var i=e.parentsUntil(".oj-tree","li:eq(0)");return!!i.length&&i},_getNext:function(e,t){return-1===(e=this._getNode(e))?this._$container.find("> ul > li:first-child"):!!e.length&&(t?e.nextAll("li").length>0&&e.nextAll("li:eq(0)"):e.hasClass(n._OJ_EXPANDED)?e.find("li:eq(0)"):e.nextAll("li").length>0?e.nextAll("li:eq(0)"):e.parentsUntil(".oj-tree","li").next("li").eq(0))},_getParent:function(e){if(-1===(e=this._getNode(e))||!e.length)return!1;var t=e.parentsUntil(".oj-tree","li:eq(0)");return t.length?t:-1},_getChildren:function(e){return-1===(e=this._getNode(e))?this._$container.children("ul:eq(0)").children("li"):!!e.length&&e.children("ul:eq(0)").children("li")},_isLeaf:function(e){return(e=this._getNode(e))&&-1!==e&&e.hasClass(r)},_getNodeElem:function(e){var i=this._$container_ul.find(e),a=!1;return i&&i.length&&i.length>0&&t(i).is("li")&&(a=i),a},_isSelected:function(e){var t=this._getNode(e),i=!1;return t&&t.length&&this._data.ui.selected&&(i=this._data.ui.selected.index(t)>=0),i},_reference:function(e,t){var i=e.parents("div").eq(0),n=a.__GetWidgetConstructor(i);return n&&t&&n("getCI",t),this},getCI:function(e){e.ot=this},_applyDefaults:function(e,i){null!=e&&null!=i&&t.each(i,function(t,i){null==e[t]&&(e[t]=i)})},_handleDisabledChanged:function(e){var t;void 0!==e&&((t=this._$container_ul.hasClass(n._OJ_DISABLED))||(t=!1),t!==e&&(e?(this._$container_ul.addClass(n._OJ_DISABLED),this._$container_ul.prop("disabled",!0)):(this._$container_ul.removeClass(n._OJ_DISABLED),this._$container_ul.prop("disabled",!1)),this._treeDisable(e)))},_treeDisable:function(e){(e=e||!1)?(this._data.core.locked=!0,this._data.ui.opacity=this._$container.children("ul").css("opacity"),this._$container_ul.addClass(n._OJ_DISABLED).css("opacity","0.9")):(this._data.core.locked=!1,this._$container_ul.removeClass(n._OJ_DISABLED).css("opacity",this._data.ui.opacity))},_isTreeDisabled:function(){return this._data.core.locked},_handleSelectionOptionChange:function(e){var i=e.slice(0),a=[],n=this;t.grep(i,function(e,t){var s=n._getNodeElem(e);return!!s&&(a.push(s),i[t]=s[0],!0)});var s=this._getSelected();t.each(s,function(e,i){var s=a.length,r=t(i).attr("id"),o=!1;for(e=0;e<s;e++)if(r===a[e].attr("id")){o=!0;break}o||n._deselect(i)}),this._setSelected(a,null)},_prepare_move:function(e,t,i,a,n){var s={};if(t=-1!==t&&t?this._getNode(t):-1,this._reference(e,s),s.rt=this,s.o=s.ot._getNode(e),s.r=t,s.p=void 0===i||!1===i?"last":i,n||!this._data.core.prepMoveBlk.o||this._data.core.prepMoveBlk.o[0]!==s.o[0]||this._data.core.prepMoveBlk.r[0]!==s.r[0]||this._data.core.prepMoveBlk.p!==s.p){if(-1!==s.r&&s.r){if(!/^(before|after)$/.test(s.p)&&!this._isLoaded(s.r))return this._load_node(s.r,function(){this._prepare_move(e,t,i,a,!0)});switch(s.p){case"before":s.cp=s.r.index(),s.cr=s.rt._getParent(s.r);break;case"after":s.cp=s.r.index()+1,s.cr=s.rt._getParent(s.r);break;case"inside":case"first":s.cp=0,s.cr=s.r;break;case"last":s.cp=s.r.find(" > ul > li").length,s.cr=s.r;break;default:s.cp=s.p,s.cr=s.r}}else switch(s.cr=-1,s.p){case"first":case"before":case"inside":s.cp=0;break;case"after":case"last":s.cp=s.rt._$container.find(" > ul > li").length;break;default:s.cp=s.p}s.np=-1===s.cr?s.rt._getContainer():s.cr,s.op=s.ot._getParent(s.o),s.cop=s.o.index(),-1===s.op&&(s.op=s.ot?s.ot._$container:this._$container),!/^(before|after)$/.test(s.p)&&s.op&&s.np&&s.op[0]===s.np[0]&&s.o.index()<s.cp&&(s.cp+=1),s.or=s.np.find(" > ul > li:nth-child("+(s.cp+1)+")"),this._data.core.prepMoveBlk=s,a&&a.call(this,this._data.core.prepMoveBlk,"prepare_move")}else a&&a.call(this,this._data.core.prepMoveBlk)},_checkMove:function(){var e=this._data.core.prepMoveBlk,t=!0,i=-1===e.r?this._$container:e.r;if(!e||!e.o||e.or[0]===e.o[0])return!1;if(!e.r)return!1;if(!e.cy){if(e.op&&e.np&&e.op[0]===e.np[0]&&e.cp-1===e.o.index())return!1;e.o.each(function(){if(-1!==i.parentsUntil(".oj-tree","li").addBack().index(this))return t=!1,!1})}return t},_renameNode:function(e,t){e=this._getNode(e),this.__rollback();var i=this.getText(e);if(e&&e.length){var a=this._emitEvent({obj:e,func:"rename",title:t,prevTitle:i},"before");if("boolean"==typeof a&&!a)return}e&&e.length&&this._set_text.apply(this,Array.prototype.slice.call(arguments))&&this._emitEvent({obj:e,title:t,prevTitle:i},"rename")},_moveNode:function(e,i,a,s,o,d){if(!o){e=this._getNode(e);var l=this._emitEvent({obj:e,func:"move"},"before");if("boolean"==typeof l&&!l)return!1}if(!(e.hasClass&&e.hasClass(n._OJ_DISABLED)||this._data.core.locked)){if(!o)return this._prepare_move(e,i,a,function(e){e.ot===e.rt||e.cy||e.ot.deselect(e.o),this._moveNode(e,!1,!1,s,!0,d)});if(s&&(this._data.core.prepMoveBlk.cy=!0),!d&&!this._checkMove())return!1;this.__rollback();var h=!1;s?(h=e.o.clone(!0)).find("*[id]").addBack().each(function(){this.id&&(this.id="copy_"+this.id)}):h=e.o,e.or.length?e.or.before(h):(e.np.children("ul").length||t("<ul></ul>").appendTo(e.np),e.np.children("ul:eq(0)").append(h));try{e.ot._cleanNode(e.op),e.rt._cleanNode(e.np),e.op.find("> ul > li").length||e.op.removeClass("oj-expanded oj-collapsed").removeAttr("aria-expanded").addClass(r).children("ul").remove()}catch(e){}s&&(this._data.core.prepMoveBlk.cy=!0,this._data.core.prepMoveBlk.oc=h);var c=t.extend(!0,{},this._data.core.prepMoveBlk);return c.obj=e.o,this._emitEvent(c,"move"),this._data.core.prepMoveBlk}},_getMoveBlk:function(){return this._data.crrm.prepMoveBlk},_getType:function(e){var t=null;return this.options.types&&(t=this._getNode(e)),!(!t||!t.length)&&(t.attr(this.options.types.attr)||"default")},_setType:function(e,t){var i=this.options.types,a=!1;if(e=this._getNode(e),i&&e&&-1!==e&&e.length&&t){var n=i.attr,s=i.types;n&&s&&s[t]&&(e.attr(n,t),e.addClass("oj-tree-type"),a=!0)}return a},_canTypedNodeMove:function(e,t){var i=!0,a=this.options.types;if(a&&(a=a.types)){var n=this._getType(e);(a[n]&&void 0!==a[n][t]||a.default&&void 0!==a.default[t])&&!1===this._check(t,e)&&(i=!1)}return i},_check:function(e,i,a){i=this._getNode(i);var n=!1,s=this._getType(i),r=this._getOptions().types,o=!1;if(-1===i){if(!r[e])return;n=r[e]}else{if(!1===s)return;(o=!!this._data.types.defaults.useData&&i.data("oj-tree"))&&o.types&&void 0!==o.types[e]?n=o.types[e]:r.types[s]&&void 0!==r.types[s][e]?n=r.types[s][e]:r.types.default&&void 0!==r.types.default[e]&&(n=r.types.default[e])}return t.isFunction(n)&&(n=n.call(this,i)),n},_cleanNode:function(i){var a,s,l,c=this._getDndContext(),_=e.TreeDndContext;c.isDragEnabled()&&(a=_._OJ_DRAGGABLE,s="draggable",l=!0),c.isDropEnabled()&&(a+=" "+_._OJ_VALID_DROP),(i=(i=i&&-1!==i?t(i):this._$container_ul).is("li")?i.find("li").addBack():i.find("li")).removeClass("oj-tree-last").addClass("oj-tree-node").addClass(a).attr(s,l).filter("li:last-child").addClass("oj-tree-last").end().filter(":has(li)").not(".oj-expanded").removeClass(r).addClass(n._OJ_COLLAPSED).attr("aria-expanded","false"),i.not(".oj-expanded, .oj-collapsed").addClass(r).children("ul").remove();var u=!!this.options.types&&this.options.types.attr;t.each(i,function(){var e=t(this),i=e.find("> ins");i.length>1&&(i=t(i[0])),e.hasClass(r)?(i.removeClass(h),i.addClass(o)):(i.addClass(h),i.removeClass(d)),u&&e.attr(u)&&e.addClass("oj-tree-type")})},_createNode:function(e,i,a,s,r){if(e=e||-1,-1!==(e=this._getNode(e))&&!e.length)return null;var o;if(i=void 0===i?"last":i,!r&&!this._isLoaded(e))return this._load_node(e,function(){this._createNode(e,i,a,s,!0)}),null;if(this.__rollback(),!(a=this._parseJson(a)))return null;a=a.children();var d=t(a[0]);switch(-1===e&&(e=this._$container,"before"===i&&(i="first"),"after"===i&&(i="last")),i){case"before":e.before(d),o=this._getParent(e);break;case"after":e.after(d),o=this._getParent(e);break;case"inside":case"first":e.children("ul").length||e.append("<ul></ul>"),e.children("ul").prepend(d),o=e;break;case"last":e.children("ul").length||e.append("<ul></ul>"),e.children("ul").append(d),o=e;break;default:e.children("ul").length||e.append("<ul></ul>"),i||(i=0),(o=e.children("ul").children("li").eq(i)).length?o.before(d):e.children("ul").append(d),o=e}return-1!==o&&o.get(0)!==this._$container.get(0)||(o=-1),this._cleanNode(o),this._emitEvent({obj:d,parent:o},"create"),s&&s.call(this,d),this._$container_ul[0].childNodes.length>1&&this._$container_ul.find("."+n._OJ_TEMPNODE).remove(),d},_expand:function(e,i,a){if(!(e=this._getNode(e))||!e.length)return!1;if(a=a||!1,!e.hasClass(n._OJ_DISABLED)&&!this._data.core.locked){if(!e.hasClass(n._OJ_COLLAPSED))return i&&i.call(),!1;var s=this._emitEvent({obj:e,func:"expand"},"before");if("boolean"!=typeof s||s){var r=a?0:this._animDuration,o=this;this._isLoaded(e)?(this.options.expandParents&&e.parentsUntil(".oj-tree",".oj-collapsed").each(function(){o._expand(this,!1,!0)}),e.removeClass(n._OJ_COLLAPSED).addClass(n._OJ_EXPANDED).attr("aria-expanded","true").children("a").removeClass(l),t(e.children()[0]).removeClass(n._OJ_SELECTED).addClass("oj-default"),this._busyStack.push({op:"e",id:e.attr("id")}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+e.attr("id")+"' is animating."),!a&&r?this._slide(e,!1):this._transitionEnd(t(e.children("UL")[0]),e),i&&i.call()):(e.children("a").addClass(l),this._load_node(e,function(){o._expand(e,i,a)},i))}}},_expandAll:function(e,t,i){var a=e||-1;(e=e?this._getNode(e):-1)&&-1!==e?a=e:e=this._$container_ul,i?e=e.find("li.oj-collapsed"):(i=e,e=e.is(".oj-collapsed")?e.find("li.oj-collapsed").addBack():e.find("li.oj-collapsed"));var n=this;e.each(function(){var e=this;n._isLoaded(this)?n._expand(this,!1,!t):n.expand(this,function(){n._expandAll(e,t,i)},!t)}),0===i.find("li.oj-collapsed").length&&this._emitEvent({obj:e,targ:a},"expandAll")},_select:function(t,i,a){var s=this._data.core,r=this._data.ui,o=s.selectMode;if(0===o)return!1;if(-1===(t=this._getNode(t))||!t||!t.length)return!1;if(t.hasClass(n._OJ_DISABLED)||s.locked)return!1;a&&"touchend"===a.type||(r.touchEvent=!1);var d=this._isSelected(t);if(!d){var l=this._emitEvent({obj:t,func:"select"},"before");if("boolean"==typeof l&&!l)return!1}var h=this.options.selection.slice(0),c=this.options,_=r.defaults.selectMultipleModifier,u=r.defaults.selectRangeModifier,p=r.defaults.disableSelectingChildren,f="on"===_||!1!==_&&a&&e.DomUtils.isMetaKeyPressed(a),g=!1!==u&&a&&a[u+"Key"]&&r.lastSelected&&this._data.ui.lastSelected[0]!==t[0]&&r.lastSelected.parent()[0]===t.parent()[0],v=!0,m=this;if(i){if(p&&f&&(t.parentsUntil(".oj-tree","li").children("a.oj-selected").length||t.children("ul").find("a.oj-selected:eq(0)").length))return!1;switch(v=!1,!0){case g:r.lastSelected.addClass("oj-tree-last-selected"),t=t[t.index()<r.lastSelected.index()?"nextUntil":"prevUntil"](".oj-tree-last-selected").addBack(),-1===o||t.length<o?(r.lastSelected.removeClass("oj-tree-last-selected"),r.selected.each(function(){this!==r.lastSelected[0]&&m._deselect(this)}),d=!1,v=!0):v=!1;break;case r.touchEvent&&-1===o:r.touchEvent=!1,this.toggleSelect(t),v=!1;break;case d&&!f:if(!a)break;this._deselectAll(),r.spacebar||(d=!1),v=!0;break;case!d&&!f:a?r.selected&&1===r.selected.length?this._deselect(r.selected):this._deselectAll(r.selected):1===o?this._deselect(r.selected):o>1&&this._deselectAll(),v=!0;break;case d&&f:this.deselect(t);break;case!d&&f:(-1===o||r.selected.length+1<=o)&&(v=!0)}}var D=!1;return v&&!d&&(g||(r.lastSelected=t),t.children("a").addClass(n._OJ_SELECTED),t.attr("aria-selected","true"),D=!0,c.selectedParentExpand&&t.parents(".oj-collapsed").each(function(){m._expand(this,!1,!0)}),r.selected=r.selected.add(t),this._fix_scroll(t.eq(0)),s.suppressSelectEvent||this._fireOptionChangeEvent("selection",h,null,a)),D},_deselect:function(e){if(!(e=this._getNode(e)).length)return!1;e.hasClass(n._OJ_DISABLED)||this._data.core.locked||this._isSelected(e)&&(e.children("a").removeClass(n._OJ_SELECTED),e.removeAttr("aria-selected"),this._data.ui.selected=this._data.ui.selected.not(e),this._data.ui.lastSelected&&this._data.ui.lastSelected.length&&this._data.ui.lastSelected.get(0)===e.get(0)&&(this._data.ui.lastSelected=this._data.ui.selected.eq(0)))},_deselectAll:function(e){if(!this._data.core.locked){var i=e?t(e).find("a.oj-selected").parent():this._$container.find("a.oj-selected").parent();if(i.not(".oj-disabled"),0!==i.length){var a=this;t.each(i,function(){a._deselect(this)})}}},_setSelected:function(e,i){if(!this._data.core.locked&&e&&e.length>0){var a=this;t.each(e,function(e,t){t&&a._select(t,!0,i)})}},_handleNodeTapClick:function(e){if(e.preventDefault(),e.currentTarget.blur(),!t(e.currentTarget).hasClass(l)){if(this._setFocus(),!this._data.ui.focused){var i=this._getNode(e.currentTarget);i.length>0&&-1!==i&&(this._data.ui.lastHovered=i),this._$container_ul.focus()}this._select(e.currentTarget,!0,e)}this._data.ui.touchEvent=!1},_disclosureHover:function(e,i){if(!(e=t(e)).hasClass(n._OJ_DISABLED)&&!this._data.core.locked){var a=e.parent(),s=a.hasClass(n._OJ_EXPANDED),r=a.hasClass(n._OJ_COLLAPSED);(s||r)&&(i?(e.addClass(n._OJ_HOVER),e.removeClass("oj-default"),e.removeClass(n._OJ_SELECTED)):(e.removeClass(n._OJ_HOVER),e.addClass("oj-default")))}},_hover:function(e){if(!this._data.menu.activeNode&&(e=this._getNode(e)).length&&!e.hasClass(n._OJ_DISABLED)&&!this._data.core.locked&&!e.hasClass(n._OJ_HOVER)){var t=this._emitEvent({obj:e,func:"hover"},"before");("boolean"!=typeof t||t)&&(e.hasClass(n._OJ_HOVER)||this._dehover(),this._data.ui.hovered=e.children("a").addClass(n._OJ_HOVER).parent(),this._$container_ul.attr("aria-activedescendant",this._data.ui.hovered.attr("id")),this._fix_scroll(e),this._emitEvent({obj:e},"hover"))}},_dehover:function(){if(!this._data.menu.activeNode){var e=this._data.ui.hovered;if(e&&e.length&&!e.hasClass(n._OJ_DISABLED)&&!this._data.core.locked){var t=e.find("a.oj-hover");(t.length||(t=this._$container_ul.find("a.oj-hover")).length)&&(t=t.removeClass(n._OJ_HOVER).parent(),this._$container_ul.removeAttr("aria-activedescendant"),this._data.ui.hovered=null,null!=e.attr("id")&&this._emitEvent({obj:e},"dehover"))}}},_refresh:function(e){this._refresh_core(e)},_refresh_core:function(e){var t=e||-1,i=this;this._save_opened(),this._saveSelected(),e||(e=-1),(e=this._getNode(e))?t=e:e=-1,-1!==e?e.children("UL").remove():(this._$container_ul.empty(),this._processExistingMarkup()),this._load_node(e,function(){i._emitEvent({obj:t},"refresh"),i._reload_nodes(),i._rehover()})},_refresh_ui:function(e){this._saveSelected(),this._refresh_core(e)},after_close:function(e){this._emitEvent({obj:e},"after_close",!0)},_reopen:function(){var e=this;this._data.core.toExpand.length&&t.each(this._data.core.toExpand,function(t,i){e._expand(i,!1,!0)}),this._emitEvent({},"reopen",!0)},_rehover:function(){var e,t=this._data.ui.lastHovered;t&&(e=t.attr("id"))&&(t=this._getNode("#"+e)),this._data.ui.lastHovered=t,this._data.ui.hovered=t},_getSelected:function(e){for(var i=e?t(e).find("a.oj-selected").parent():this._data.ui.selected,a=[],n=i.length,s=0;s<n;s++)a.push(i[s]);return a},_set_text:function(e,t){return!!(e=this._getNode(e)).length&&(e=(e=e.children("a:eq(0)")).find("span:eq(0)"),this._emitEvent({obj:e,name:t},"set_text",!0),e[0].textContent=t,t)},_loadNodes:function(){0!==this._data.ds.type&&-1!==this._data.ds.type?this._load_node(-1,function(){this._loaded(),this._reload_nodes()}):(this._applyEmptyText(),this._loaded())},_load_node:function(e,t,i){this._emitEvent({obj:e},"load_node",!0)},_isLoaded:function(e){return!0},_load_node_DS:function(e,t,i){var a=this;this._load_node_tree(e,function(){a._emitEvent({obj:a._getNode(e)},"load_node",!0),t.call(this)},i)},_isLoaded_DS:function(e){return-1===(e=this._getNode(e))||!e||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_refresh_DS:function(e){return(e=this._getNode(e))&&-1!==e&&e.removeData(c),this._refresh_ui(e)},_load_node_J:function(e,t,i){var a=this;this._loadNodeJson(e,function(){a._emitEvent({obj:a._getNode(e)},"load_node",!0),t.call(this)},i)},_isLoaded_J:function(e){var i=this.options.data;return-1===(e=this._getNode(e))||!e||!i.ajax&&!this._data.ds.progressiveRender&&!t.isFunction(i.data)||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_load_node_H:function(e,t,i){var a=this;this._loadNodeHtml(e,function(){a._emitEvent({obj:a._getNode(e)},"load_node",!0),t.call(this)},i)},_isLoaded_H:function(e){var i=this.options.data,a=null,n=null;return i&&(a=i.data||null,n=i.ajax||null),-1===(e=this._getNode(e))||!e||!n&&!t.isFunction(a)||e.is(".oj-expanded, .oj-tree-leaf")||e.children("ul").children("li").length>0},_reselect:function(){var e=this,i=this._data.ui.toSelect;(i=t.map(t.makeArray(i),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/:/g,"\\:")}))&&i.length&&(this.options.selection.length=0,this._data.ui.selected.length=t()),t.each(i,function(t,i){i&&"#"!==i&&e.select(i)}),this._data.ui.selected=this._data.ui.selected.filter(function(){return this.parentNode})},_saveSelected:function(){var e=this._data.ui;e.toSelect=[],e.selected.each(function(){this.id&&e.toSelect.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/:/g,"\\:"))})},rollback:function(e){e&&(t.isArray(e)||(e=[e]))},get_rollback:function(){return this._emitEvent(null,"get_rollback",!0),{i:this._getIndex(),h:this._$container.children("ul").clone(!0),d:this.data}},_load_node_tree:function(e,t,i){var a=e&&-1!==e?e[0].id:e||-1,n=this._JsonDSToJson(a,e);if(n.success){var s,r=!e||-1===e,o=this.options.data;if(o.data&&!o.ajax||o.data&&o.ajax&&r)r&&((s=this._parseJson(n.js,e))?(this._$container_ul.empty().append(s.children()),this._cleanNode()):this._data.ds.correctState&&this._$container_ul.empty()),t&&t.call(this);else if(!o.data&&o.ajax||o.data&&o.ajax&&!r)if(s=this._parseJson(n.js,e)){if(r){var d=this._$container_ul;d.empty().append(s.children()),d.attr("role","tree").attr("aria-labelledby",this._elemId).attr("tabindex","0").css("outline","none"),-1===this._data.core.selectMode&&d.attr("aria-multiselectable",!0)}else e.append(s).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading");this._cleanNode(e),t&&t.call(this)}else r?this._data.ds.correctState&&(this._$container_ul.empty(),t&&t.call(this)):(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),o.correct_state&&(this._correct_state(e),t&&t.call(this)))}},_JsonDSToJson:function(e,t){var i=[],a=this._tds,n={},s={success:!1,js:null};-1===e&&(e=null,n.start=0);var r=a.getChildCount(e);return r>0?(n.count=r,a.fetchChildren(e,n,{success:function(e){for(var n=e.getCount(),r=0;r<n;r++){t={};var o=e.getData(r);o&&(t.attr=o),t.title=e.m_nodes[r].title,o.metadata&&(t.metadata=e.m_nodes[r].metadata);var d=t.attr.id;if(a.getChildCount(d)>0){var l=this._JsonDSToJson(d,t);t.children=l.js}i.push(t)}s.success=!0,s.js=i}.bind(this),error:function(){s.success=!1}})):s.success=!0,s},_refresh_json:function(e){if(e=this._getNode(e),!this._data.core.locked){var i=!e||-1!==e||!e.length;if(i||!e.hasClass(n._OJ_DISABLED)){var a=this.options.data.json;return!i&&this._data.ds.progressiveUnload&&(t.isFunction(a.data)||a.ajax)&&e.removeData(c),this._refresh_ui(e)}}},_loadNodeJson:function(e,i,a){var n=this._getOptions().data,s=function(){},r=function(){},o=n&&n.data||null,d=n&&n.ajax||null;if(!n||o||d||(o=n),(e=this._getNode(e))&&-1!==e&&(this._data.ds.progressiveRender||this._data.ds.progressiveUnload)&&!e.is(".oj-expanded, .oj-tree-leaf")&&0===e.children("ul").children("li").length&&e.data(c)){var h=this._parseJson(e.data(c),e);return h&&(e.append(h),this._data.ds.progressiveUnload||e.removeData(c)),this._cleanNode(e),void(i&&i.call(this))}if(e&&-1!==e){if(e.data("oj-tree-is-loading"))return;e.data("oj-tree-is-loading",!0)}switch(!0){case!o&&!d:throw new Error("ojTree - neither data nor ajax settings supplied.");case t.isFunction(o):o.call(this,e,function(t){(t=this._parseJson(t,e))?(-1!==e&&e?(e.append(t).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading")):this._$container_ul.empty().append(t.children()),this._cleanNode(e),i&&i.call(this)):(-1!==e&&e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),this._data.ds.correctState&&this._correct_state(e)):this._data.ds.correctState&&this._$container_ul.empty(),a&&a.call(this))}.bind(this));break;case!!o&&!d||!!o&&!!d&&(!e||-1===e):if(!e||-1===e){var _=this._parseJson(o,e);_?(this._$container_ul.empty().append(_.children()),this._cleanNode()):this._data.ds.correctState&&this._$container_ul.empty()}i&&i.call(this);break;case!o&&!!d||!!o&&!!d&&e&&-1!==e:s=function(t,i,n){var s=this.ctx;s._noteLoadFailureId(this.id,!0),s._removeFromBusyStack("j",-1===e?-1:e.attr("id")),s._resolveIfBusyStackEmpty();var r=s._getOptions().data.ajax.error;r&&r.call(s,i,n,t),-1!==e&&e.length?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),"success"===i&&s._data.ds.correctState&&s._correct_state(e)):("error"===i||"success"===i&&s._data.ds.correctState)&&(s._$container_ul.empty(),s._applyEmptyText()),a&&a.call(s)},r=function(t,a,n){var r=this.ctx;r._noteLoadFailureId(this.id,!1),r._removeFromBusyStack("j",this.id);var o=r._getOptions().data.ajax.success;if(o&&(t=o.call(r,t,a,n)||t),"string"==typeof t){var d=t.replace(/^[\s\n]+$/,"");try{d=JSON.parse(d)}catch(e){d=null}if(!d)return s.call(this,n,"Bad JSON","")}if(t=r._parseJson(t,e)){if(-1!==e&&e)e.append(t).children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading");else{var h=r._$container_ul;h.empty().append(t.children()),h.attr("role","tree").attr("aria-labelledby",r._elemId).attr("tabindex","0").css("outline","none"),-1===r._data.core.selectMode&&h.attr("aria-multiselectable",!0)}r._cleanNode(e),i&&i.call(r)}else-1!==e&&e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),r._data.ds.correctState&&(r._correct_state(e),i&&i.call(r))):r._data.ds.correctState&&(r._$container_ul.empty(),i&&i.call(r))};var u=-1===e?-1:e.attr("id");this._busyStack.push({op:"j",id:u}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+u+"' is lazyloading.");var p={ctx:this,id:u};n.ajax.context=p,n.ajax.error=s,n.ajax.success=r,n.dataType||(n.ajax.dataType="json"),p.type=n.ajax.dataType,t.isFunction(n.ajax.url)&&(n.ajax.url=n.ajax.url.call(this,e),p.url=n.ajax.url),t.isFunction(n.ajax.data)&&(n.ajax.data=n.ajax.data.call(this,e)),t.ajax(n.ajax)}},_parseJson:function(e,i,a){var s=!1;if(!e)return s;if(this._data.ds.progressiveUnload&&i&&-1!==i&&i.data(c,s),"string"==typeof e)try{e=JSON.parse(e)}catch(t){e=[]}if(t.isArray(e)){if(s=t("<ul>"),!e.length)return!1;for(var r=e.length,o=0;o<r;o++){var l=this._parseJson(e[o],i,!0);l.length&&(s=s.append(l))}s=s.children()}else{"string"==typeof e&&(e={data:e});var _="string"==typeof e.title?e.title:" ";s=t("<li role='treeitem' ></li>"),e.attr&&(this._data.types.defType&&!e.attr.type&&(e.attr.type="oj-tree-deftype",s.addClass("oj-tree-type")),s.attr(e.attr)),e.metadata&&s.data(e.metadata),e.children&&0===e.children.length&&s.addClass(n._OJ_COLLAPSED),e.state&&"s"===e.state&&s.addClass(n._OJ_SELECTED),e.data||(e.data={dummy:0});var u=!1,p=t("<a></a>");if(t.each(e.data,function(i,a){if(t.isFunction(a)&&(a=a.call(this,e)),"object"==typeof a&&("attr"===i?p.attr(a):"style"===i&&p.css(a),"language"===i&&p.addClass(a)),!u){var n=t("<span class='oj-tree-title'>");n[0].textContent=_,p.prepend("<ins class='oj-tree-icon "+d+" oj-component-icon'>&#160;</ins>",n),u=!0}!a.icon&&e.icon&&(a.icon=e.icon),a.icon&&(-1===a.icon.indexOf("/")?p.children("ins").addClass(a.icon):p.children("ins").css("background","url('"+a.icon+"') center center no-repeat"))}),s.append(p),s.prepend("<ins class='"+h+"'>&#160;</ins>"),e.children)if(this._data.ds.progressiveRender&&"expanded"!==e.state)s.addClass(n._OJ_COLLAPSED).attr("aria-expanded","false").data(c,e.children);else if(this._data.ds.progressiveUnload&&s.data(c,e.children),t.isArray(e.children)&&e.children.length&&(p=this._parseJson(e.children,i,!0)).length){var f=t("<ul role='group' ></ul>");f.append(p),s.append(f)}}if(!a){var g=t("<ul></ul>");g.append(s),s=g}return s},__getJson:function(e,i,a,n){var s=[],r=this.options,o=this;return(e=this._getNode(e))&&-1!==e||(e=this._$container.find("> ul > li")),i=t.isArray(i)?i:["id","class"],!n&&r.types&&i.push(r.types.attr),a=t.isArray(a)?a:[],e.each(function(){var e,n=t(this),r={},d=o._noteUserAttrs(n);(i.length||d&&d.length)&&(r.attr={}),d&&t.each(d,function(e,t){n.attr(t).length>0&&(r.attr[t]=n.attr(t))}),t.each(i,function(e,t){var i=n.attr(t);i&&i.length&&i.replace(/oj-tree[^ ]*/gi,"").length&&(i=(" "+i).replace(/ oj-tree[^ ]*/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(r.attr[t]=i)}),o._getDndContext().isDragEnabled()&&o._isSelected(n)&&(r.state="s");var l,h=n.data();l=h,0!==Object.keys(l).length&&(r.metadata=h);var c=n.children("a"),_=null;c.each(function(){var i,n=t(this);a.length||n.children("ins").get(0).style.backgroundImage.length||n.children("ins").get(0).className&&n.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").length?(i=o.getText(n),t.each(a,function(t,i){(e=(" "+(n.attr(i)||"")).replace(/ oj-tree[^ ]*/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(_||(_={attr:{}}),_.attr[i]=e)}),n.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").replace(/^\s+$/gi,"").length&&(e=n.children("ins").get(0).className.replace(/oj-tree[^ ]*|$/gi,"").replace(/ oj-[^ ]*/gi,"").replace(/\s+$/gi," ").replace(/^ /,"").replace(/ $/,"")).length&&(_||(_={}),_.icon=e),n.children("ins").get(0).style.backgroundImage.length&&(e=n.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")).length&&(_||(_={}),_.icon=e)):i=o.getText(n),null!=_&&(r.data||(r.data=[]),c.length>1?r.data.push(_):r.data=_),r.title=i}),(n=n.find("> ul > li")).length&&(r.children=o.__getJson(n,i,a,!0)),s.push(r)}),s},_noteUserAttrs:function(e){var t,i=e[0].attributes;if(i&&i.length){t=[];for(var a=p.length,n=0;n<i.length;n++){var s=i[n];if(s){var r;for(s=s.name,r=0;r<a&&(p[r]!==s&&0!==s.indexOf("aria-"));r++);r>=a&&t.push(s)}}}return t&&t.length>0?t:null},_correct_state:function(e){if(!(e=this._getNode(e))||-1===e)return!1;e.removeClass("oj-collapsed oj-expanded").removeAttr("aria-expanded").addClass(r).children("ul").remove(),e.find("ins:first-child").removeClass(h).addClass(o),this._emitEvent({obj:e},"correct_state",!0)},_loaded:function(){this._emitEvent(null,"loaded")},_loadNodeHtml:function(e,i,a){var n=this._getOptions().data,s=function(){},r=function(){},c=n&&n.data||null,_=n&&n.ajax||null;if((e=this._getNode(e))&&-1!==e){if(e.data("oj-tree-is-loading"))return;e.data("oj-tree-is-loading",!0)}switch(!0){case!c&&!_&&n&&"string"==typeof n:this._loadHtmlString(n,e,i,a);break;case t.isFunction(c):c.call(this,e,function(t){this._loadHtmlString(t,e,i,a)}.bind(this));break;case!c&&!_:e&&-1!==e||(this._$container_ul.empty().append(this._data.html.cloneMarkup).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon' >&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li").children("ins:first-child").addClass(h),this._insertHtmlTextSpan(this._$container_ul),this._data.types.defType&&this._addDefType(this._$container_ul),this._cleanNode(),this._$container_ul.find("ul").attr("role","group"),this._$container_ul.find("li").attr("role","treeitem")),i&&i.call(this);break;case!!c&&!_||!!c&&!!_&&(!e||-1===e):if(!e||-1===e){var u=t(c);u.is("ul")||(u=t("<ul></ul>").append(u)),this._$container_ul.empty().append(u.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),this._insertHtmlTextSpan(this._$container_ul),this._data.types.defType&&this._addDefType(this._$container_ul),this._cleanNode(),this._$container_ul.find("ul").attr("role","group"),this._$container_ul.find("li").attr("role","treeitem")}i&&i.call(this);break;case!c&&!!_||!!c&&!!_&&e&&-1!==e:e=this._getNode(e),s=function(t,i,n){var s=this.ctx;s._noteLoadFailureId(this.id,!0),s._removeFromBusyStack("j",-1===e?-1:e.attr("id")),s._resolveIfBusyStackEmpty();var r=s._getOptions().data.ajax.error;r&&r.call(s,t,i,n),-1!==e&&e.length?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),"success"===i&&s._data.ds.correctState&&s._correct_state(e)):"success"===i&&s._data.ds.correctState&&(s._$container_ul.empty(),s._applyEmptyText()),a&&a.call(s)},r=function(a,n,r){var c,_=this.ctx;_._noteLoadFailureId(this.id,!1),_._removeFromBusyStack("j",-1===e?-1:e.attr("id"));var u=_._getOptions().data.ajax.success;if(u&&(a=u.call(_,a,n,r)||a),""===a||a&&a.toString&&""===a.toString().replace(/^[\s\n]+$/,""))return s.call(_,r,n,"");if(a){(a=t(a)).is("ul")||(a=t("<ul></ul>").append(a)),-1!==e&&e?(e.children("a.oj-tree-loading").removeClass(l),_._removeEmptyUL(e),e.append(a).children("ul").find("li, a").filter(function(){return!_.firstChild||!_.firstChild.tagName||"INS"!==_.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),e.removeData("oj-tree-is-loading"),e.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),c=e):(_._$container_ul.empty().append(a.children()).find("li, a").filter(function(){return!_.firstChild||!_.firstChild.tagName||"INS"!==_.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),_._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),c=_._$container_ul),_._handleHtmlParentNoChildren(c),_._insertHtmlTextSpan(c);var p=c.children("UL");p.length>=1&&(p=p.first().find("span.oj-tree-title"),t.each(p,function(){this.textContent=_._escapeHtml(this.textContent)})),_._data.types.defType&&c&&_._addDefType(this._$container_ul),_._cleanNode(e),i&&i.call(_)}else e&&-1!==e?(e.children("a.oj-tree-loading").removeClass(l),e.removeData("oj-tree-is-loading"),_._data.ds.correctState&&(_._correct_state(e),i&&i.call(_))):_._data.ds.correctState&&(_._$container_ul.empty(),i&&i.call(_)),_._$container_ul.find("ul").attr("role","group"),_._$container_ul.find("li").attr("role","treeitem")};var p=-1===e?-1:e.attr("id");this._busyStack.push({op:"j",id:p}),this._addBusyState("Tree (id='"+this._elemId+"') : node id='"+p+"' is lazyloading.");var f={ctx:this,id:p};n.ajax.context=f,n.ajax.error=s,n.ajax.success=r,n.ajax.dataType||(n.ajax.dataType="html"),f.type=n.ajax.dataType,t.isFunction(n.ajax.url)&&(n.ajax.url=n.ajax.url.call(this,e),f.url=n.ajax.url),t.isFunction(n.ajax.data)&&(n.ajax.data=n.ajax.data.call(this,e)),t.ajax(n.ajax)}},_handleHtmlParentNoChildren:function(e){var i=e.find(e.is("ul")?"li ul":"ul").filter(function(){return!this.firstChild||0===this.childNodes.length||1===this.childNodes.length&&3===this.firstChild.nodeType});t.each(i,function(){t(this).closest("li").addClass(n._OJ_COLLAPSED)})},_removeEmptyUL:function(e){var t=e.find("ul").filter(function(){return!this.firstChild||0===this.childNodes.length||1===this.childNodes.length&&3===this.firstChild.nodeType});t.length>0&&t.remove()},_loadHtmlString:function(e,i,a,n){var s;if(e&&""!==e&&e.toString&&""!==e.toString().replace(/^[\s\n]+$/,"")){(e=t(e)).is("ul")||(e=t("<ul></ul>").append(e)),-1!==i&&i?(i.children("a.oj-tree-loading").removeClass(l),i.append(e).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass("oj-tree-node-icon").addClass("oj-tree-icon"),i.removeData("oj-tree-is-loading"),s=i,this._addDefType(this.obj)):(this._$container_ul.empty().append(e.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||"INS"!==this.firstChild.tagName}).prepend("<ins class='oj-tree-icon oj-tree-disclosure-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".oj-tree-node-icon").addClass(d).addClass(o),this._$container_ul.find("li.oj-tree-leaf ins:first-child").removeClass(h).removeClass(d).addClass(o),s=this._$container_ul,this._addDefType(this._$container_ul)),s&&this._insertHtmlTextSpan(s);var r=s.children("UL");if(r.length>=1){r=r.first().find("span.oj-tree-title");var c=this;t.each(r,function(){this.textContent=c._escapeHtml(this.textContent)})}this._cleanNode(i),a&&a.call(this)}else i&&-1!==i?(i.children("a.oj-tree-loading").removeClass(l),i.removeData("oj-tree-is-loading"),this._data.ds.correctState&&(this._correct_state(i),a&&a.call(this))):this._data.ds.correctState&&(this._$container_ul.empty(),a&&a.call(this))},_insertHtmlTextSpan:function(e){t.each(e.find("li a"),function(e,t){var i=t.innerHTML;i=i.replace("ins>","ins><span class='oj-tree-title'>"),i+="</span>",t.innerHTML=i})},_addDefType:function(e){if(this._data.types.defType){var i=this.options.types,a=i?i.attr:this._data.types.defaults.attr;t.each(e.find("li"),function(e,i){(i=t(i)).attr(a)||i.attr(a,"oj-tree-deftype").addClass("oj-tree-type")})}},_save_opened:function(){var e=this;this._data.core.toExpand=[],this._$container_ul.find("li.oj-expanded").each(function(){this.id&&e._data.core.toExpand.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/:/g,"\\:"))})},_reload_nodes:function(e){var i=this,a=!0,n=[],s=[];e||(this._data.core.reopen=!1,this._data.core.refreshing=!0),this._isOptExpandAll()&&(this._data.core.toExpand=[],this._$container_ul.find("li.oj-collapsed").each(function(){var e="#"+t(this).attr("id");i.isExpanded(e)||i._isLoadFailureId(e)||i._data.core.toExpand.push(e)})),this._data.core.toExpand=t.map(t.makeArray(this._data.core.toExpand),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/:/g,"\\:")}),this._data.core.toLoad=t.map(t.makeArray(this._data.core.toLoad),function(e){return"#"+e.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/:/g,"\\:")}),this._data.core.toExpand.length&&(this._data.core.toLoad=this._data.core.toLoad.concat(this._data.core.toExpand),this._data.core.toLoad=this._data.core.toLoad.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])),this._data.core.toLoad.length&&(t.each(this._data.core.toLoad,function(e,t){if("#"===t)return!0;i._$container.find(t).length?i.isExpanded(t)||n.push(t):s.push(t)}),n.length&&(this._data.core.toLoad=s,t.each(n,function(e,t){i._isLoaded(t)||(i._load_node(t,function(){i._reload_nodes(!0)},function(){i._reload_nodes(!0)}),a=!1)}))),this._data.core.toExpand.length&&t.each(this._data.core.toExpand,function(e,t){i.isExpanded(t)||i._expand(t,!1,!0)}),a&&(this._data.core.reopen&&clearTimeout(this._data.core.reopen),this._data.core.reopen=setTimeout(function(){i._emitEvent({},"reload_nodes",!0),i._resolveIfBusyStackEmpty()},50),this._data.core.refreshing=!1,this._reopen())},setTheme:function(e,i){if(!e)return!1;i||(i=this._data.themes._themes+e+"/style.css"),-1===t.inArray(i,this._data.themes.themes_loaded)&&(v({url:i}),this._data.themes.themes_loaded.push(i)),this._data.themes.theme!==e&&(this._$container.removeClass("oj-tree-"+this._data.themes.theme),this._data.themes.theme=e),this._$container.addClass("oj-tree-"+e),this._data.themes.dots?this._showDots():this._hideDots(),this._data.themes.icons?this._showIcons():this._hideIcons()},_isTheme:function(){return null!=this._data.themes},_getTheme:function(){return this._data.themes.theme},isIcons:function(){return this._data.themes.icons},_showIcons:function(){this._data.themes.icons=!0,this._$container.children("ul").removeClass("oj-tree-no-icons")},_hideIcons:function(){this._data.themes.icons=!1,this._$container.children("ul").addClass("oj-tree-no-icons")},toggleIcons:function(){},_enableKeys:function(){this._data.keys.enabled=!0},_initTree:function(){this._initData(),this._initCoreOpts(),this._initUIOpts(),this._initDSOpts(!0),this._initTypeOpts(),this._getDndContext().initDnDOpts(),this._initMenuOpts(),this._initCore(),this._initUI(),this._initThemes(),this._initDataSource(),this._initTypes(),this._getDndContext().initDnD(),this._initKeys(),this._initMenu()},_emitEvent:function(e,i,a){if(i&&"string"===t.type(i)&&(!0!==this._data.core.locked||"unlock"===i||"isLocked"===i||"lock"===i)){var n=Array.prototype.slice.call(arguments),s=this._$container,r="before"===i,o=!a;o||(i="_tree"+i);var d={};if(d.item=e?e.obj:void 0,d.inst=s,r){var l=e.func;d.func=l,d.args=n,"rename"===l&&(d.title=e.title,d.prevTitle=e.prevTitle)}else o&&("move"===i?(d.position=e.p,d.reference=e.r,d.data=e):"rename"===i?(d.title=e.title,d.prevTitle=e.prevTitle):"remove"===i?(d.parent=e.parent,d.prev=e.prev):"delete"===i?(d.prev=e.prev,d.parent=e.parent):"expandAll"===i||"collapseAll"===i||"deselectAll"===i?d.targ=e.targ:"loaded"===i?d.item=-1:"paste"===i&&(d.position=e.p,d.reference=e.r));if(o){var h=this._trigger(i,new t.Event("oj"+i),d);if(r)return void 0!==h&&(h=!!h),h}else this._$container.trigger(i,d)}},_fireOptionChangeEvent:function(e,t,i,a){"selection"===e&&(null==i&&(i=this._getSelected()),this._compareSelectionValues(t,i)||this.option(e,i,{_context:{originalEvent:a,internalSet:!0},changed:!0}))},__rollback:function(){return this.get_rollback()},_start:function(){var e;this._isRtl&&this._$container.addClass("oj-tree-rtl").css("direction","rtl"),this._$container.html("<ul role='tree' tabindex='0' class='oj-tree-list' style='outline:none'"+(-1===this._data.core.selectMode?" aria-multiselectable='true'":"")+" aria-labelledby='"+this._elemId+"'><li class='oj-tree-last oj-tree-leaf'><ins class='oj-tree-icon'>&#160;</ins><a class='oj-tree-loading' href='#'><ins class='oj-tree-icon'>&#160;</ins>"+this._getString("stateLoading")+"</a></li></ul>"),this._$container_ul=this._$container.children("ul:eq(0)"),this._$container.data("oj-tree-instance-id",this._getIndex()),this._data.core.li_height=this._$container_ul.find("li.oj-collapsed, li.oj-tree-leaf").eq(0).height()||18,this._isTouch&&this._$container.delegate(".oj-tree-list ins.oj-tree-disclosure-icon","touchend.ojtree",function(e){e.preventDefault();var i=t(e.target);this.toggleExpand(i)}.bind(this)),this._$container.delegate(".oj-tree-list ins.oj-tree-disclosure-icon","click.ojtree",function(e){var i=t(e.target);this.toggleExpand(i)}.bind(this)).delegate(".oj-tree-list ins.oj-tree-disclosure-icon","mousedown",function(e){this._data.ui.disclosureClick=!0,t(e.target).removeClass("oj-default").removeClass(n._OJ_HOVER).addClass(n._OJ_SELECTED)}.bind(this)).delegate(".oj-tree-list ins.oj-tree-disclosure-icon","mouseup",function(e){t(e.target).removeClass(n._OJ_SELECTED).addClass("oj-default")}).bind("mousedown.ojtree",function(e){this._setFocus(),e.shiftKey&&(this._getDndContext()&&this._getDndContext().isDragEnabled()||e.preventDefault())}.bind(this)).bind("dblclick.ojtree",function(){var e;if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){e=window.getSelection();try{e.removeAllRanges(),e.collapse(document.getElementsByTagName("body")[0],0)}catch(e){}}}),this._$container_ul.focus(function(){return this._data.ui.disclosureClick?(this._data.ui.disclosureClick=!1,!1):(this._data.ui.focused=!0,this._data.ui.hovered?e=this._data.ui.hovered:this._data.ui.lastHovered?(this._data.ui.hovered=this._data.ui.lastHovered,e=this._data.ui.hovered):this._data.ui.lastSelected&&this._data.ui.lastSelected.length>0?(this._data.ui.hovered=this._data.ui.lastSelected,e=this._data.ui.hovered):e=this._$container_ul.find("li:first"),e&&(this.hover(e),this._data.ui.lastHovered=null,this._$container_ul.find("a.oj-selected").removeClass("oj-tree-inactive")),!1);var e}.bind(this)).blur(function(){this._data.ui.focused=!1,this._data.ui.lastHovered=this._data.ui.hovered,this._data.ui.lastHovered&&this.dehover(this._data.ui.hovered),this._$container_ul.find("a.oj-selected").addClass("oj-tree-inactive")}.bind(this)),this._emitEvent({},"init",!0),this._loadNodes(),this._data.menu.usermenu&&this._applyMenu(),e={_handler:this._keyHandler,_selector:this._$container_ul,_this:this},f.push(e),t(e._selector).keydown(g),this._enableKeys()},_initCore:function(){this._data.core.locked=!1,this._$container.addClass("oj-tree oj-tree-"+this._getIndex()),this._$container.css("outline","none"),this._$container.css("MozUserSelect","none"),this._$container.css("WebkitTouchCallout","none"),this._$container.css("WebkitUserSelect","none"),this._$container.css("-ms-user-select","none"),this._$container.css("WebkitTapHighlightColor","rgba(0,0,0,0)")},_initUI:function(){this._data.ui.selected=t(),this._data.ui.lastSelected=!1,this._data.ui.hovered=null;var e=this.options.selection;e&&"array"===t.type(e)&&e.length>0&&(this._data.ui.toSelect=e,this.options.selection=[]),this._isTouch&&this._$container.delegate(".oj-tree-list a","touchend.ojtree",t.proxy(function(e){this._data.ui.touchEvent=!0,this._handleNodeTapClick(e),t(e.currentTarget).hasClass(l)||this.dehover()},this)),this._$container.delegate(".oj-tree-list a","click.ojtree",function(e){this._data.ui.touchEvent=!1,this._handleNodeTapClick(e)}.bind(this)).delegate(".oj-tree-list a","mouseenter.ojtree",function(e){t(e.currentTarget).hasClass(l)||this.hover(e.target)}.bind(this)).delegate(".oj-tree-list a","mouseleave.ojtree",function(e){t(e.currentTarget).hasClass(l)||this.dehover(e.target)}.bind(this)).delegate(".oj-tree-list .oj-tree-disclosure-icon","mouseenter.ojtree",function(e){t(e.currentTarget).hasClass(l)||this._disclosureHover(e.target,!0)}.bind(this)).delegate(".oj-tree-list .oj-tree-disclosure-icon","mouseleave.ojtree",function(e){t(e.currentTarget).hasClass(l)||this._disclosureHover(e.target,!1)}.bind(this)).bind("_treereopen",function(){this._reselect()}.bind(this)).bind("_treeget_rollback",function(){this.dehover(),this._saveSelected()}.bind(this)).bind("ojcollapse",function(e,i){var a=this._getNode(i.item),n=a&&a.length?a.children("ul").find("a.oj-selected"):t(),s=this;!1!==this.options.selectedParentCollapse&&n.length&&n.each(function(){"selectParent"===s.options.selectedParentCollapse?(s.deselect(this),s.select(a)):"deselect"===s.options.selectedParentCollapse&&s.deselect(this)})}.bind(this)).bind("ojremove",function(e,t){var i=this.options.selectPrevOnDelete,a=this._getNode(t.item),n=a&&a.length?a.find("a.oj-selected"):[],s=this;n.each(function(){if(s.deselect(this),s._data.ui.lastHovered){var e=s._getNode(this);e&&s._data.ui.lastHovered.attr("id")===e.attr("id")&&(s._data.ui.lastHovered=null)}}),i&&n.length&&t.prev&&t.prev.each(function(){if(this.parentNode)return s.select(this),!1})}.bind(this)).bind("ojmove",function(e,t){var i=t.data,a=i.cy;if(a&&i.oc&&(i.oc.find("a.oj-selected").removeClass(n._OJ_SELECTED),i.oc.removeAttr("aria-selected")),i.ot!==i.rt&&!a){var s=i.ot._data.ui;s.lastHovered&&(i.o.attr("id")===s.lastHovered.attr("id")&&(s.lastHovered=null),s.lastSelected&&i.o.attr("id")===s.lastSelected.attr("id")&&(s.lastSelected=null))}})},_initDataSource:function(){this._initTreeData(),this._initJsonData(),this._initHtmlData()},_initTreeData:function(){1===this._data.ds.type&&(this._tds=this.options.data||null,this._load_node=this._load_node_DS,this._isLoaded=this._isLoaded_DS,this._refresh=this._refresh_DS)},_initJsonData:function(){3===this._data.ds.type&&(this._data.ds.progressiveUnload&&this._$container.bind("_treeafter_close",function(e,t){t.item.children("ul").remove()}),this._load_node=this._load_node_J,this._isLoaded=this._isLoaded_J,this._refresh=this._refresh_json)},_initHtmlData:function(){4===this._data.ds.type&&(this._processExistingMarkup(),this._load_node=this._load_node_H,this._isLoaded=this._isLoaded_H,this._refresh=this._refresh_ui)},_processExistingMarkup:function(){this._data.html.useExistingMarkup&&(this._data.html.markup_ul||(this._data.html.markup_ul=this._$container.find(" > ul"),this._data.html.markup=this._data.html.markup_ul.find(" > li"),this._data.html.cloneMarkup=this._data.html.markup.clone(!0),this._data.html.cloneMarkup.find("li").addBack().contents().filter(function(){return 3===this.nodeType}).remove(),this._transformElemIds(this._data.html.markup_ul),this._data.html.markup_div=t("<div id='oj-tree-existing-markup-"+this._getIndex()+"' style='display:none'>").append(this._data.html.markup_ul),this._$container.after(this._data.html.markup_div)))},_transformElemIds:function(e){var i=t(e).find("li"),a=this._getIndex();i.each(function(e,t){t.setAttribute("id",a+"_"+t.getAttribute("id"))})},_unTransformElemIds:function(e){t(e).find("li").each(function(e,t){var i=t.getAttribute("id"),a=i.indexOf("_");i=i.substr(a+1),t.setAttribute("id",i)})},_initThemes:function(){!1===this._data.themes._themes&&(this._data.themes._themes="themes/"),this._$container.bind("_treeinit",t.proxy(function(){var e=this.options;this._data.themes.dots=e.dots,this._data.themes.icons=e.icons,this.setTheme(this._data.themes.theme,this._data.themes.url)},this)).bind("ojloaded",t.proxy(function(){this._data.themes.dots?this._showDots():this._hideDots(),this._data.themes.icons?this._showIcons():this._hideIcons()},this))},_initTypes:function(){var e=this.options.types;e&&this._$container.bind("_treeinit",t.proxy(function(){var i=t.extend(!0,{},e.types),a=e.attr||this._data.types.defaults.attr,n="",s=this;t.each(i,function(e,i){t.each(i,function(e){/^(maxDepth|maxChildren|icon|validChildren)$/.test(e)||s._data.types.attachTo.push(e)});var r=typeof i.icon;if("undefined"===r){if("boolean"!==(r=typeof i.image)||i.image){if(!i.image&&!i.position)return!0}else i.image="ojt$none";i.icon={},i.image&&(i.icon.image=i.image,delete i.image),void 0!==i.position&&(i.icon.position=i.position,delete i.position)}(i.icon.image||i.icon.position)&&("default"===e?(s._data.types.defType=!0,n+=".oj-tree-"+s._getIndex()+" .oj-tree-list li.oj-tree-type a > .oj-tree-node-icon { ",n+=s._addTypeCss(i,n),n+="} ",n+=".oj-tree-"+s._getIndex()+" .oj-tree-list li["+a+'="oj-tree-deftype"].oj-tree-type > a ins.oj-tree-node-icon { '):i.icon.image&&(n+=".oj-tree-"+s._getIndex()+" .oj-tree-list li["+a+'="'+e+'"].oj-tree-type > a > ins.oj-tree-node-icon { '),n+=s._addTypeCss(i,n),n+="} ")}),""!==n&&v({str:n,title:"oj-tree-types"})},this)).bind("ojbefore",function(e,i){var a=i.func,n=i.item,s=!!this._data.types.defaults.useData&&this._getNode(n),r=!(!s||-1===s||!s.length)&&s.data("oj-tree");if(r&&r.types&&!1===r[a])return e.stopImmediatePropagation(),!1;if(-1!==t.inArray(a,this._data.types.attachTo)){if(!i.item||!i.item.tagName&&!i.item.jquery)return;if(!this._canTypedNodeMove(n,a))return e.stopImmediatePropagation(),!1}}.bind(this))},_addTypeCss:function(e){var t="";return"ojt$none"!==e.icon.image?t+=" background-image:url("+e.icon.image+"); ":t+=" background-image:none; ",e.icon.position?t+=" background-position:"+e.icon.position+"; ":t+=" background-position:0 0; ",t},_getDndContext:function(){return this._TreeDndContext||(this._TreeDndContext=new e.TreeDndContext(this)),this._TreeDndContext},_initKeys:function(){},_initMenu:function(e){var i;if(e||this.options.contextMenu||(i=this._$container.attr("contextmenu"))&&(this.options.contextMenu="#"+i),i=e||this.options.contextMenu){var a=t(i);if(a.length>0){a.css("display","none");var n=this._data.menu;n.$container=a,n.usermenu=!0}this._data.menu.usermenu&&e&&this._applyMenu()}},_handleContextMenuSelect:function(e,t){if(!t.inst&&this._data.menu.treeDivId===this._elemId){var i=t?t.item.attr("id"):void 0;"ojtreecopy"===i?this._crrm_copy(this._data.menu.node):"ojtreecut"===i?this._crrm_cut(this._data.menu.node):"ojtreepaste"===i||"ojtreepastebefore"===i||"ojtreepasteafter"===i?this._crrm_paste(this._data.menu.node,i):"ojtreeremove"===i?this._isSelected(this._data.menu.node)?this._crrm_remove():this._crrm_remove(this._data.menu.node):"ojtreerename"===i?this._crrm_rename(this._data.menu.node):"ojtreecreate"===i&&this._crrm_create(this._data.menu.node)}},_NotifyContextMenuGesture:function(e,i,a){var s="keyboard"===a;if("contextmenu"===i.type||s||"touch"===a)if(this._data.menu.node=s?this._data.ui.hovered||this._data.menu.activeNode:t(i.target),this._data.menu.activeNode=null,this._data.menu.node){if(!s){var r=t(i.originalEvent.target);if(r.is("LI")||r.hasClass("oj-tree")||r.is("UL"))return}this._data.menu.treeDivId=this._data.menu.node.closest("div").attr("id");var o={launcher:this._$container_ul};if(s){var d=this._data.menu.node.find(".oj-tree-title")[0];o.position={of:d}}if(this._data.menu.usermenu&&(this._data.menu.$elemPaste||this._data.menu.$elemPasteBefore||this._data.menu.$elemPasteAfter)){for(var l=!this._data.crrm.ct_nodes&&!this._data.crrm.cp_nodes,h=[this._data.menu.$elemPaste,this._data.menu.$elemPasteBefore,this._data.menu.$elemPasteAfter],c=!1,_=0;_<h.length;_++){var u=h[_];u&&!!u.hasClass(n._OJ_DISABLED)!==l&&(l?u.addClass(n._OJ_DISABLED):u.removeClass(n._OJ_DISABLED),c=!0)}c&&this._data.menu.$container.ojMenu("refresh")}this._OpenContextMenu(i,a,o)}else i.preventDefault()},_initCoreOpts:function(){var e=this.options.selectionMode;"none"===(e=null==e?"single":e)?e=0:"single"===e?e=1:"multiple"===e&&(e=-1),this._data.core.selectMode=e,this._data.themes.icons=this.options.icons,this._initExpandedOpts(),this._data.core.toLoad=this.options.initLoaded},_initUIOpts:function(){},_initDSOpts:function(i){var a=this.options.data;if(this._data.ds.type=0,this._data.html.useExistingMarkup=!1,this._data.html.cloneMarkup=!1,this._loadFailureIds={},a){var n=t.type(a);if("string"===n)this._isHtml(a)?this._data.ds.type=4:(this._data.ds.type=3,this._initJsonOpts());else if("array"===n)this._data.ds.type=3;else if("object"===n){try{a instanceof e.JsonTreeDataSource&&(this._data.ds.type=1)}catch(e){this._data.ds.type=-1}if(1!==this._data.ds.type)try{a instanceof e.CollectionTreeDataSource&&(this._data.ds.type=2)}catch(e){this._data.ds.type=-1}if(1===this._data.ds.type||2===this._data.ds.type)this._initTreeDSOpts();else if(a.data||a.ajax){var s=a.dataType;s?"json"===s?(this._data.ds.type=3,this._initJsonOpts()):"html"===s&&(this._data.ds.type=4,this._initHtmlOpts()):(a.dataType="json",this._data.ds.type=3,this._initJsonOpts())}}}i&&0===this._data.ds.type&&this._$container.find("ul").length>0&&(this._data.ds.type=4,this._data.html.useExistingMarkup=!0)},_initTreeDSOpts:function(){},_initJsonOpts:function(){},_initHtmlOpts:function(){},_initMenuOpts:function(){},_initTypeOpts:function(){var e=this.options.types;"object"==typeof e&&this._applyDefaults(e,{attr:this._data.types.defaults.attr})},_initExpandedOpts:function(){this._data.core.toExpand=this._varCopy(this.options,"initExpanded"),null==this._data.core.toExpand&&(this._data.core.toExpand=[])},_initData:function(){var e=this._data;e.core={initLoaded:[],selectMode:1,load_open:!1,li_height:0,toExpand:!1,toLoad:!1,prepMoveBlk:{},suppressSelectEvent:!1,strings:{}},e.ui={selected:t(),lastSelected:!1,hovered:null,lastHovered:null,disclosureClick:!1,toSelect:null,opacity:1,spacebar:!1,focused:!1,animDurDiv:null,touchEvent:!1},e.ui.defaults={selectMultipleModifier:"ctrl",selectRangeModifier:"shift",disableSelectingChildren:!1},e.crrm={},e.crrm.cp_nodes=!1,e.crrm.ct_nodes=!1,e.crrm.defaults={inputWidthLimit:200,move:{alwaysCopy:!1,openOnMove:!0,defaultPosition:"last",checkMove:function(){return!0}}},e.crrm.prepMoveBlk={},e.ds={},e.ds.progressiveRender=!1,e.ds.progressiveUnload=!1,e.ds.correctState=!0,e.ds.type=0,e.json={},e.json.defaults={data:!1,ajax:!1},e.html={},e.html.defaults={data:!1,ajax:!1},e.html.useExistingMarkup=!1,e.html.markup_ul=!1,e.html.markup_div=!1,e.html.markup=!1,e.html.cloneMarkup=!1,e.themes={},e.themes.icons=!0,e.themes.dots=!1,e.themes.theme="default",e.themes.url=!1,e.themes.themes_loaded=[],e.themes._themes=!1,e.types={},e.types.attachTo=[],e.types.defType=!1,e.types.defaults={maxChildren:-1,maxDepth:-1,validChildren:"all",useData:!1,attr:"type",types:{default:{maxChildren:-1,maxDepth:-1,validChildren:"all"}}},e.menu={},e.menu.usermenu=!1,e.menu.$container=!1,e.menu.$elemPaste=!1,e.menu.$elemPasteAfter=!1,e.menu.$elemPasteBefore=!1,e.menu.node=!1,e.menu.activeNode=!1,e.keys={},e.keys.enabled=!0,e.keys.bound=[]},_fix_scroll:function(e){var t=this._$container[0];if(t.scrollHeight>t.offsetHeight){if(!(e=this._getNode(e))||-1===e||!e.length||!e.is(":visible"))return;var i=e.offset().top-this._$container.offset().top;i<0&&(t.scrollTop+=i-1),i+this._data.core.li_height+(t.scrollWidth>t.offsetWidth?s:0)>t.offsetHeight&&(t.scrollTop+=i-t.offsetHeight+this._data.core.li_height+1+(t.scrollWidth>t.offsetWidth?s:0))}},_setFocus:function(){},_unsetFocus:function(){},_newIndex:function(){return m+=1},_getIndex:function(){return this._index},_getOptions:function(){return t.extend(!0,{},this.options)},_getContainer:function(){return this._$container},_getContainerList:function(){return this._$container_ul},_keyHandler:{up:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getPrev(e)),!1},"ctrl+up":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getPrev(e)),!1},"shift+up":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.select(this._getPrev(e),-1!==this._data.ui.selectMode),!1},down:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getNext(e)),!1},"ctrl+down":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.hover(this._getNext(e)),!1},"shift+down":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected||-1;return this.select(this._getNext(e),-1!==this._data.ui.selectMode),!1},left:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(n._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},"ctrl+left":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(n._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},"shift+left":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&(e.hasClass(n._OJ_EXPANDED)?this.collapse(e):this.hover(this._getPrev(e))),!1},right:function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(n._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},"ctrl+right":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(n._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},"shift+right":function(){var e=this._data.ui.hovered||this._data.ui.lastSelected;return e&&e.length&&(e.hasClass(n._OJ_COLLAPSED)?this.expand(e):this.hover(this._getNext(e))),!1},space:function(){return this._data.ui.hovered&&(this._data.ui.spacebar=!0,this._data.ui.hovered.children("a:eq(0)").click(),this._data.ui.spacebar=!1),!1},home:function(){return this.hover(this._$container_ul.find("li:first")),!1},end:function(){var e=this._$container_ul.find("li.oj-tree-last:visible");return e&&e.length&&this.hover(e[e.length-1]),!1},"*":function(){return this._expandAll(-1,!1),!1},"ctrl+space":function(){if(this._data.ui.hovered){var e=t.Event("click");e.ctrlKey=!0,this._data.ui.hovered.children("a:eq(0)").trigger(e)}return!1},"shift+space":function(){if(this._data.ui.hovered){var e=t.Event("click");e.shiftKey=!0,this._data.ui.hovered.children("a:eq(0)").trigger(e)}return!1},"shift+home":function(e){var i,a=this._data.ui.hovered;if(a){var n=!0,s=this,r=this._$container_ul.find("li:visible");this._data.core.suppressSelectEvent=!0,i=this.options.selection.slice(0),a=a[0],t.each(r,function(e,t){return t===a&&(n=!1),s._select(t,!0),n}),this._data.core.suppressSelectEvent=!1,this._fireOptionChangeEvent("selection",i,null,e)}return!1},"shift+pgdn":function(e){var i,a=this._data.ui.lastSelected||this._data.ui.hovered;if(a){var n=!1,s=this,r=this._$container_ul.find("li:visible");this._data.core.suppressSelectEvent=!0,i=this.options.selection.slice(0),a=a[0],t.each(r,function(e,t){return n||(n=t===a),n&&!s._isSelected(t)&&s._select(t,!0),!0}),this._data.core.suppressSelectEvent=!1,this._fireOptionChangeEvent("selection",i,null,e)}return!1},f2:function(){return this._crrm_rename(this._data.ui.hovered||this._data.ui.lastSelected),!1},del:function(){return this.remove(this._data.ui.hovered||this._getNode(null)),!1}},_applyMenu:function(){if(this._data.menu.usermenu){var e=this._data.menu.$container,i=this;e.on("ojselect",this._handleContextMenuSelect.bind(this));var a=e.find("[data-oj-command]"),n=!1;a.each(function(){var e;0===t(this).children("a").length&&(e=t(this).attr("data-oj-command").split("oj-tree-"),t(this).replaceWith(i._buildContextMenuItem(e[e.length-1])),t(this).hasClass("oj-menu-divider")&&t(this).removeClass("oj-menu-divider").addClass("oj-menu-item"),n=!0)}),n&&e.ojMenu("refresh"),this._data.menu.$elemPaste=e.find("#ojtreepaste"),this._data.menu.$elemPasteAfter=e.find("#ojtreepasteafter"),this._data.menu.$elemPasteBefore=e.find("#ojtreepastebefore")}},_clearMenu:function(){var e=this._data.menu;e.usermenu&&(e.usermenu=!1,e.$container.off("ojselect"),e.$container=null)},_buildContextMenuItem:function(e){return t(this._buildContextMenuListItem(e))},_buildContextMenuListItem:function(e){return"<li id="+_[e]+">"+this._buildContextMenuLabel(e)+"</li>"},_buildContextMenuLabel:function(e){var t=u[e];return'<a href="#">'+this._getString(t)+"</a>"},_isLoadFailureId:function(e){return e="#"===(e=-1===e?"-1":e).charAt(0)?e.substr(1):e,!!this._loadFailureIds[e]},_noteLoadFailureId:function(e,t){e=-1===e?"-1":e,t?this._loadFailureIds[e]=!0:this._loadFailureIds[e]&&delete this._loadFailureIds[e]},_crrm_cut:function(e){if(e=e.closest("li"),this._isSelected(e)&&(e=null),!(e=this._getNode(e,!0))||!e.length)return!1;this._data.crrm.cp_nodes=!1,this._data.crrm.ct_nodes=e,this._emitEvent({obj:e},"cut")},_crrm_copy:function(e){if(e=e.closest("li"),this._isSelected(e)&&(e=null),!(e=this._getNode(e,!0))||!e.length)return!1;this._data.crrm.ct_nodes=!1,this._data.crrm.cp_nodes=e,this._emitEvent({obj:e},"copy")},_crrm_paste:function(e,t){if(!(e=this._getNode(e))||!e.length)return!1;var i=this._data.crrm.ct_nodes?this._data.crrm.ct_nodes:this._data.crrm.cp_nodes;if(!this._data.crrm.ct_nodes&&!this._data.crrm.cp_nodes)return!1;var a="inside";"ojtreepasteafter"===t?a="after":"ojtreepastebefore"===t&&(a="before"),this._data.crrm.ct_nodes&&(this._crrm_move_node(this._data.crrm.ct_nodes,e,a,!1,!1,!0),this._data.crrm.ct_nodes=!1),this._data.crrm.cp_nodes&&this._crrm_move_node(this._data.crrm.cp_nodes,e,a,!0,!1,!0),this._emitEvent({obj:i,p:a,r:e},"paste")},_crrm_move_node:function(e,t,i,a,n,s){var r=this._data.crrm.defaults.move;if(!n)return void 0===i&&(i=r.defaultPosition),"inside"!==i||r.defaultPosition.match(/^(before|after)$/)||(i=r.defaultPosition),this._moveNode(e,t,i,a,!1,s);(!0===r.alwaysCopy||"multitree"===r.alwaysCopy&&e.rt._getIndex()!==e.ot._getIndex())&&(a=!0),this._moveNode(e,t,i,a,!0,s)},_crrm_remove:function(e){e=this._getNode(e,!0),this.__rollback(),this.remove(e)},_crrm_rename:function(e){e=this._getNode(e),this.__rollback(),this._crrm_showInput(e,function(e,t,i){})},_crrm_showInput:function(e,i){e=this._getNode(e);var a=this._isRtl,n=this._data.crrm.defaults.inputWidthLimit,s=e.children("ins").width(),r=e.find("> a:visible > ins").width()*e.find("> a:visible > ins").length,o=this.getText(e),d=t("<div></div>",{css:{position:"absolute",top:"-200px",left:a?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),l=e.css("position","relative").append(t("<input />",{value:o,class:"oj-tree-rename-input",css:{padding:"0",border:"1px solid silver",position:"absolute",left:a?"auto":s+r+4+"px",right:a?s+r+4+"px":"auto",top:"0px",height:this._data.core.li_height-2+"px",lineHeight:this._data.core.li_height-2+"px",width:"150px"},blur:t.proxy(function(){var t=e.children(".oj-tree-rename-input"),a=t.val();""===(a=this._escapeHtml(a))&&(a=o),d.remove(),t.remove(),this._set_text(e,o),a!==o&&this._renameNode(e,a),i.call(this,e,a,o),e.css("position","")},this),keyup:function(e){var t=e.keyCode||e.which;27===t?(this.value=o,this.blur()):13===t?this.blur():l.width(Math.min(d.text("pW"+this.value).width(),n))},keypress:function(e){if(13===(e.keyCode||e.which))return!1}})).children(".oj-tree-rename-input");this._set_text(e,""),d.css({fontFamily:l.css("fontFamily")||"",fontSize:l.css("fontSize")||"",fontWeight:l.css("fontWeight")||"",fontStyle:l.css("fontStyle")||"",fontStretch:l.css("fontStretch")||"",fontVariant:l.css("fontVariant")||"",letterSpacing:l.css("letterSpacing")||"",wordSpacing:l.css("wordSpacing")||""}),l.width(Math.min(d.text("pW"+l[0].value).width(),n))[0].select()},_crrm_create:function(e,i,a,s,r){var o=this;return(e=this._getNode(e))||(e=-1),this.__rollback(),this._createNode(e,i,a,function(e){var i=this._getParent(e),a=t(e).index();s&&s.call(this,e),i.length&&i.hasClass(n._OJ_COLLAPSED)&&this.expand(i,!1,!0),r?o._emitEvent({obj:e,name:this.getText(e),parent:i,position:a}):this._crrm_showInput(e,function(e,t,n){o._emitEvent({obj:e,name:t,parent:i,position:a})})})},_isHtml:function(e){var t=!1;return e&&e.length>=3&&(t="<"===(e=e.trim()).charAt(0)),t},_applyEmptyText:function(){var e=this.options.emptyText;if("string"!=typeof e&&(e=this._getString("labelNoData")),e&&e.length>0){var i=this._$container_ul,a=t("<li class='oj-tree-empty'></li>");a[0].textContent=e,i.empty().append(a)}},_processSubId:function(e){var t,i,a;if(e&&(t=e.subId),!t)return null;var n=t.split("[");if(3===n.length&&(n[0]=n[0].trim(),"oj-tree-node"===n[0])){n[1]=n[1].trim();var s=n[1].charAt(0),r=n[1].indexOf(s,1);if(r>=0){var o=n[1].substring(1,r).trim();if(n[2]=n[2].trim(),s=n[2].charAt(0),(r=n[2].indexOf(s,1))>=0){var d=n[2].substring(1,r).trim();try{i=this._getNode(o)}catch(e){i=null}if(d&&i&&-1!==i)switch(d){case"icon":this._data.themes.icons&&(a=i.find(" > a > ins:eq(0)"));break;case"link":a=i.find(" > a:eq(0)");break;case"disclosure":this._isLeaf(i)||(a=i.find(" > ins:eq(0)"));break;case"title":a=i.find(" > a > span")}}}}return a&&a.length?a[0]:null},_getSubIdFromNodeElem:function(e){var i=e?this._getNode(e):null,a=null;if(i&&-1!==i&&i.length&&i.hasClass("oj-tree-node")&&e.tagName&&e.parentNode){var n=e.tagName,s=e.parentNode.tagName;"SPAN"===n?a="title":"A"===n?a="link":"INS"===n&&(e=t(e),"LI"===s&&e.hasClass("oj-tree-disclosure-icon")?a="disclosure":"A"===s&&e.hasClass(d)&&(a="icon"))}return a?{subId:"oj-tree-node['#"+i.attr("id")+"']['"+a+"']"}:null},_hideDots:function(){this._data.themes.dots=!1,this._$container.children("ul").addClass("oj-tree-no-dots")},_showDots:function(){this._data.themes.dots=!0,this._$container.children("ul").removeClass("oj-tree-no-dots")},_isOptExpandAll:function(){var e=this.options.initExpanded;return e&&"all"===e||t.isArray(e)&&e.length&&"all"===e[0]},_getString:function(e){var t=this._data.core.strings,i=t[e];return i||(i=this.getTranslatedString(e),i=this._escapeHtml(i),t[e]=i),i},_escapeHtml:function(e){var i=document.createElement("div");return t(i).text(e),i.textContent},_getNodeHeight:function(){return this._data.core.li_height},_getAnimDuration:function(){var e=0;if(window.getComputedStyle){var i=this._data.ui.animDurDiv;i||(i=t("<div id='ojtree-comp-animduration'><span class='oj-tree-transition'>dummy</span></div>"),this._data.ui.animDurDiv=i,t("body").append(i));var a=i[0].childNodes[0],n=window.getComputedStyle(a);if(n=n.transitionDuration?n.transitionDuration:n["-webkit-transition-duration"]?n["-webkit-transition-duration"]:0,i.detach(),"string"==typeof n&&n.length>1)if("s"===n.charAt(n.length-1).toLowerCase())n=n.substring(0,n.length-1),n=parseFloat(n),isNaN(n)||(e=1e3*n);else if(n.length>2){var s=n.substring(n.length-2).toLowerCase();"ms"===s&&(s=n.substring(0,n.length-2),n=parseFloat(n),isNaN(n)||(e=n))}}return e},_varCopy:function(e,i){var a={};return a[i]=e[i],t.extend(!0,{},a)[i]},_trace:function(e,t){}})}()});